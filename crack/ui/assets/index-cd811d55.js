import{cr as ve,cZ as _e,dk as me,cs as p,c_ as fe,cq as g,da as ze,cv as s,cy as r,cG as m,cB as t,cC as v,cA as l,cF as B,cL as _,cK as u,cz as q,cD as ee,cE as te,di as Ae,dj as Le,cM as I,e3 as ae,cu as Ue,cS as Te,cw as qe,cU as de,cI as ce,dV as re,de as X,cY as pe,ea as xe,cP as Fe}from"./index-a6cfd98b.js";import{_ as Ge}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-fc9285e5.js";import{_ as Ne}from"./index.vue_vue_type_style_index_0_scope_true_lang-e4ef588b.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-be0b3f51.js";const He={class:"flex align-center"},je={class:"dialog-footer"},Qe=ve({__name:"SelectDocumentDialog",emits:["refresh"],setup(ge,{expose:x,emit:O}){const{dataset:P,document:S}=_e(),F=me(),{params:{id:z,documentId:w}}=F,A=O,k=p(),i=p(!1),D=p(!1),f=p({dataset_id:"",document_id:""}),L=fe({dataset_id:[{required:!0,message:g("views.log.selectDatasetPlaceholder"),trigger:"change"}],document_id:[{required:!0,message:g("views.log.documentPlaceholder"),trigger:"change"}]}),$=p([]),d=p([]),h=p(!1),U=p([]);ze(i,c=>{var o;c||(f.value={dataset_id:"",document_id:""},$.value=[],d.value=[],U.value=[],(o=k.value)==null||o.clearValidate())});function G(c){f.value.document_id="",Y(c)}function Y(c){S.asyncGetAllDocument(c,D).then(o=>{var V;d.value=(V=o.data)==null?void 0:V.filter(R=>R.id!==w)})}function N(){P.asyncGetAllDataset(D).then(c=>{$.value=c.data})}const Z=c=>{var o;U.value=c,N(),(o=k.value)==null||o.clearValidate(),i.value=!0},J=async c=>{c&&await c.validate((o,V)=>{o&&ae.putMigrateMulParagraph(z,w,f.value.dataset_id,f.value.document_id,U.value,D).then(()=>{A("refresh"),i.value=!1})})};return x({open:Z}),(c,o)=>{const V=s("AppAvatar"),R=s("el-option"),H=s("el-select"),M=s("el-form-item"),j=s("el-form"),T=s("el-button"),Q=s("el-dialog");return r(),m(Q,{title:`${c.$t("views.log.selectDataset")}/${c.$t("common.fileUpload.document")}`,modelValue:i.value,"onUpdate:modelValue":o[5]||(o[5]=e=>i.value=e),width:"500","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:t(()=>[v("span",je,[l(T,{onClick:o[3]||(o[3]=B(e=>i.value=!1,["prevent"]))},{default:t(()=>[_(u(c.$t("common.cancel")),1)]),_:1}),l(T,{type:"primary",onClick:o[4]||(o[4]=e=>J(k.value)),loading:D.value},{default:t(()=>[_(u(c.$t("views.document.setting.migration")),1)]),_:1},8,["loading"])])]),default:t(()=>[l(j,{ref_key:"formRef",ref:k,model:f.value,"label-position":"top","require-asterisk-position":"right",rules:L,onSubmit:o[2]||(o[2]=B(()=>{},["prevent"]))},{default:t(()=>[l(M,{label:c.$t("views.log.selectDataset"),prop:"dataset_id"},{default:t(()=>[l(H,{modelValue:f.value.dataset_id,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value.dataset_id=e),filterable:"",placeholder:c.$t("views.log.selectDatasetPlaceholder"),loading:h.value,onChange:G},{default:t(()=>[(r(!0),q(ee,null,te($.value,e=>(r(),m(R,{key:e.id,label:e.name,value:e.id},{default:t(()=>[v("span",He,[!e.dataset_id&&e.type==="1"?(r(),m(V,{key:0,class:"mr-12 avatar-purple",shape:"square",size:24},{default:t(()=>o[6]||(o[6]=[v("img",{src:Ae,style:{width:"58%"},alt:""},null,-1)])),_:1})):!e.dataset_id&&e.type==="0"?(r(),m(V,{key:1,class:"mr-12 avatar-blue",shape:"square",size:24},{default:t(()=>o[7]||(o[7]=[v("img",{src:Le,style:{width:"58%"},alt:""},null,-1)])),_:1})):I("",!0),_(" "+u(e.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"]),l(M,{label:c.$t("views.log.saveToDocument"),prop:"document_id"},{default:t(()=>[l(H,{modelValue:f.value.document_id,"onUpdate:modelValue":o[1]||(o[1]=e=>f.value.document_id=e),filterable:"",placeholder:c.$t("views.log.documentPlaceholder"),loading:h.value},{default:t(()=>[(r(!0),q(ee,null,te(d.value,e=>(r(),m(R,{key:e.id,label:e.name,value:e.id},{default:t(()=>[_(u(e.name),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),Ee={style:{width:"78%"}},Ke={style:{display:"inline-block"}},Oe={class:"break-all"},Ye={class:"header-button"},Ze={class:"document-detail__main p-16"},Je={class:"flex-between p-8"},We={class:"document-detail-height"},Xe={class:"footer-content flex-between"},et={class:"footer-content flex-between"},tt={key:0,class:"mul-operation border-t w-full"},at={class:"ml-8"},lt=ve({__name:"index",setup(ge){const{paragraph:x}=_e(),O=me(),{params:{id:P,documentId:S}}=O,F=p(),z=p(),w=p(!1),A=p(!1),k=p({}),i=p([]),D=p(""),f=p(""),L=p("title"),$=p(!1),d=p([]),h=fe({current_page:1,page_size:30,total:0});function U(){i.value=i.value.filter(e=>!d.value.includes(e.id)),d.value=[],X(g("views.document.tip.migrationSuccess"))}function G(e){e&&(d.value=[e.id]),F.value.open(d.value)}function Y(){pe(`${g("views.document.delete.confirmTitle1")} ${d.value.length} ${g("views.document.delete.confirmTitle2")}`,g("views.paragraph.delete.confirmMessage"),{confirmButtonText:g("common.delete"),confirmButtonClass:"danger"}).then(()=>{ae.delMulParagraph(P,S,d.value,A).then(()=>{i.value=i.value.filter(e=>!d.value.includes(e.id)),d.value=[],X(g("views.document.delete.successMessage"))})}).catch(()=>{})}function N(e){$.value=e,d.value=[]}function Z(e){d.value.includes(e)?d.value.splice(d.value.indexOf(e),1):d.value.push(e)}function J(){h.current_page=1,i.value=[],M()}function c(e){const a={is_active:!e.is_active};x.asyncPutParagraph(P,S,e.id,a,A).then(y=>{const E=i.value.findIndex(C=>C.id===e.id);return i.value[E].is_active=!i.value[E].is_active,!0}).catch(()=>!1)}function o(e){pe(`${g("views.paragraph.delete.confirmTitle")} ${e.title||"-"} ?`,g("views.paragraph.delete.confirmMessage"),{confirmButtonText:g("common.delete"),confirmButtonClass:"danger"}).then(()=>{x.asyncDelParagraph(P,S,e.id,w).then(()=>{const a=i.value.findIndex(y=>y.id===e.id);i.value.splice(a,1),X(g("common.deleteSuccess"))})}).catch(()=>{})}function V(){D.value=g("views.paragraph.addParagraph"),z.value.open()}function R(e){D.value=g("views.paragraph.paragraphDetail"),z.value.open(e)}function H(){w.value=!0,xe.getDocumentDetail(P,S).then(e=>{k.value=e.data,w.value=!1}).catch(()=>{w.value=!1})}function M(){ae.getParagraph(P,S,h,f.value&&{[L.value]:f.value},w).then(e=>{i.value=[...i.value,...e.data.records],h.total=e.data.total})}function j(e){if(e){const a=i.value.findIndex(y=>y.id===e.id);i.value.splice(a,1,e)}else h.current_page=1,i.value=[],M()}const T=p();function Q(e){const a=[];e?a.push(e.id):d.value.map(y=>{y&&a.push(y)}),T.value.open(a,"paragraph")}return Ue(()=>{H(),M()}),(e,a)=>{const y=s("el-link"),E=s("el-text"),C=s("el-button"),le=s("el-option"),he=s("el-select"),we=s("el-input"),be=s("el-empty"),ne=s("CardBox"),ke=s("el-switch"),$e=s("MoreFilled"),oe=s("el-icon"),ye=s("Connection"),W=s("el-dropdown-item"),Ce=s("AppIcon"),De=s("el-dropdown-menu"),Ve=s("el-dropdown"),Pe=s("el-col"),Se=s("el-row"),Me=s("InfiniteScroll"),Re=s("el-scrollbar"),Ie=s("LayoutContainer"),Be=Te("loading");return r(),m(Ie,{"back-to":"-1",class:"document-detail"},{header:t(()=>{var n,K;return[v("div",Ee,[v("h3",Ke,u((n=k.value)==null?void 0:n.name),1),((K=k.value)==null?void 0:K.type)==="1"?(r(),m(E,{key:0,type:"info"},{default:t(()=>{var b,se;return[_("（"+u(e.$t("views.document.form.source_url.label"))+"：",1),l(y,{href:(se=(b=k.value)==null?void 0:b.meta)==null?void 0:se.source_url,target:"_blank"},{default:t(()=>{var ie,ue;return[v("span",Oe,u((ue=(ie=k.value)==null?void 0:ie.meta)==null?void 0:ue.source_url),1)]}),_:1},8,["href"]),a[10]||(a[10]=_("） "))]}),_:1})):I("",!0)]),v("div",Ye,[$.value===!1?(r(),m(C,{key:0,onClick:a[0]||(a[0]=b=>N(!0))},{default:t(()=>[_(u(e.$t("views.paragraph.setting.batchSelected")),1)]),_:1})):I("",!0),$.value===!0?(r(),m(C,{key:1,onClick:a[1]||(a[1]=b=>N(!1))},{default:t(()=>[_(u(e.$t("views.paragraph.setting.cancelSelected")),1)]),_:1})):I("",!0),$.value===!1?(r(),m(C,{key:2,onClick:V,type:"primary",disabled:w.value},{default:t(()=>[_(u(e.$t("views.paragraph.addParagraph")),1)]),_:1},8,["disabled"])):I("",!0)])]}),default:t(()=>[qe((r(),q("div",Ze,[v("div",Je,[v("span",null,u(h.total)+" "+u(e.$t("views.paragraph.title")),1),l(we,{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=n=>f.value=n),placeholder:e.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:J,clearable:""},{prepend:t(()=>[l(he,{modelValue:L.value,"onUpdate:modelValue":a[2]||(a[2]=n=>L.value=n),placeholder:"Select",style:{width:"80px"}},{default:t(()=>[l(le,{label:e.$t("common.title"),value:"title"},null,8,["label"]),l(le,{label:e.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),l(Re,null,{default:t(()=>[v("div",We,[i.value.length==0?(r(),m(be,{key:0,description:e.$t("common.noData")},null,8,["description"])):(r(),m(Me,{key:1,size:i.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":a[7]||(a[7]=n=>h.current_page=n),onLoad:M,loading:w.value},{default:t(()=>[l(Se,null,{default:t(()=>[(r(!0),q(ee,null,te(i.value,(n,K)=>(r(),m(Pe,{xs:24,sm:12,md:8,lg:6,xl:6,key:K,class:"p-8"},{default:t(()=>[$.value===!0?(r(),m(ne,{key:0,shadow:"hover",title:n.title||"-",description:n.content,class:de(["document-card cursor",d.value.includes(n.id)?"selected":""]),showIcon:!1,onClick:b=>Z(n.id)},{footer:t(()=>[v("div",Xe,[v("span",null,u(ce(re)(n==null?void 0:n.content.length)||0)+" "+u(e.$t("views.paragraph.character_count")),1)])]),default:t(()=>[v("div",{class:"active-button",onClick:a[4]||(a[4]=B(()=>{},["stop"]))})]),_:2},1032,["title","description","class","onClick"])):(r(),m(ne,{key:1,shadow:"hover",title:n.title||"-",description:n.content,class:de(["document-card cursor",n.is_active?"":"disabled"]),showIcon:!1,onClick:b=>R(n)},{footer:t(()=>[v("div",et,[v("span",null,u(ce(re)(n==null?void 0:n.content.length)||0)+" "+u(e.$t("views.paragraph.character_count")),1),v("span",{onClick:a[6]||(a[6]=B(()=>{},["stop"]))},[l(Ve,{trigger:"click"},{dropdown:t(()=>[l(De,null,{default:t(()=>[l(W,{onClick:b=>Q(n)},{default:t(()=>[l(oe,null,{default:t(()=>[l(ye)]),_:1}),_(" "+u(e.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"]),l(W,{onClick:b=>G(n)},{default:t(()=>[l(Ce,{iconName:"app-migrate"}),_(" "+u(e.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),l(W,{icon:"Delete",onClick:B(b=>o(n),["stop"])},{default:t(()=>[_(u(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:t(()=>[l(C,{text:""},{default:t(()=>[l(oe,null,{default:t(()=>[l($e)]),_:1})]),_:1})]),_:2},1024)])])]),default:t(()=>[v("div",{class:"active-button",onClick:a[5]||(a[5]=B(()=>{},["stop"]))},[l(ke,{loading:w.value,modelValue:n.is_active,"onUpdate:modelValue":b=>n.is_active=b,"before-change":()=>c(n),size:"small"},null,8,["loading","modelValue","onUpdate:modelValue","before-change"])])]),_:2},1032,["title","description","class","onClick"]))]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"]))])]),_:1}),$.value===!0?(r(),q("div",tt,[l(C,{disabled:d.value.length===0,onClick:a[8]||(a[8]=n=>Q())},{default:t(()=>[_(u(e.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),l(C,{disabled:d.value.length===0,onClick:a[9]||(a[9]=n=>G())},{default:t(()=>[_(u(e.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),l(C,{disabled:d.value.length===0,onClick:Y},{default:t(()=>[_(u(e.$t("common.delete")),1)]),_:1},8,["disabled"]),v("span",at,u(e.$t("views.document.selected"))+" "+u(d.value.length)+" "+u(e.$t("views.document.items")),1)])):I("",!0)])),[[Be,h.current_page===1&&w.value||A.value]]),l(Ge,{ref_key:"ParagraphDialogRef",ref:z,title:D.value,onRefresh:j},null,8,["title"]),l(Qe,{ref_key:"SelectDocumentDialogRef",ref:F,onRefresh:U},null,512),l(Ne,{ref_key:"GenerateRelatedDialogRef",ref:T,onRefresh:j},null,512)]),_:1})}}});const ut=Fe(lt,[["__scopeId","data-v-740990ee"]]);export{ut as default};
