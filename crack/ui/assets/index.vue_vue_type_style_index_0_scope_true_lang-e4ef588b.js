import{cr as x,dk as z,cZ as H,cs as i,c_ as K,cq as v,da as O,cv as r,cy as Z,cG as j,cB as p,cC as a,cA as l,cF as E,cL as I,cK as c,cI as J,e3 as P,de as Q,ea as W,e1 as X,cR as Y}from"./index-a6cfd98b.js";const ee={class:"content-height"},oe={class:"update-info flex border-r-4 mb-16 p-8-12"},te={class:"mt-4"},ae={class:"ml-12 lighter"},le={class:"dialog-footer"},ie=x({__name:"index",emits:["refresh"],setup(se,{expose:q,emit:A}){var M;const C=z(),{params:{id:f,documentId:R}}=C,{model:B,prompt:_,user:b}=H(),V=A,d=i(!1),s=i(!1),$=i(null),g=i([]),h=i(""),w=i(),y=(M=b.userInfo)==null?void 0:M.id,t=i(_.get(y)),S=K({model_id:[{required:!0,message:v("views.application.applicationForm.form.aiModel.placeholder"),trigger:"blur"}],prompt:[{required:!0,message:v("views.application.applicationForm.form.prompt.placeholder"),trigger:"blur"}]});O(s,e=>{var o;e||(t.value=_.get(y),(o=w.value)==null||o.clearValidate())});const N=(e,o)=>{U(),g.value=e,h.value=o,s.value=!0},G=async e=>{e&&await e.validate((o,F)=>{var m;if(o){if(_.save((m=b.userInfo)==null?void 0:m.id,t.value),h.value==="paragraph"){const u={...t.value,paragraph_id_list:g.value};P.batchGenerateRelated(f,R,u,d).then(()=>{Q(v("views.document.generateQuestion.successMessage")),V("refresh"),s.value=!1})}else if(h.value==="document"){const u={...t.value,document_id_list:g.value};W.batchGenerateRelated(f,u,d).then(()=>{Q(v("views.document.generateQuestion.successMessage")),V("refresh"),s.value=!1})}}})};function U(){d.value=!0,X.getDatasetModel(f).then(e=>{$.value=Y.groupBy(e==null?void 0:e.data,"provider"),d.value=!1}).catch(()=>{d.value=!1})}return q({open:N}),(e,o)=>{const F=r("AppIcon"),m=r("ModelSelect"),u=r("el-form-item"),D=r("el-input"),L=r("el-form"),k=r("el-button"),T=r("el-dialog");return Z(),j(T,{title:e.$t("views.document.generateQuestion.title"),modelValue:s.value,"onUpdate:modelValue":o[4]||(o[4]=n=>s.value=n),width:"650","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:p(()=>[a("span",le,[l(k,{onClick:o[2]||(o[2]=E(n=>s.value=!1,["prevent"]))},{default:p(()=>[I(c(e.$t("common.cancel")),1)]),_:1}),l(k,{type:"primary",onClick:o[3]||(o[3]=n=>G(w.value)),disabled:!J(B)||d.value},{default:p(()=>[I(c(e.$t("common.confirm")),1)]),_:1},8,["disabled"])])]),default:p(()=>[a("div",ee,[l(L,{ref_key:"FormRef",ref:w,model:t.value,rules:S,"label-position":"top","require-asterisk-position":"right"},{default:p(()=>[a("div",oe,[a("div",te,[l(F,{iconName:"app-warning-colorful",style:{"font-size":"16px"}})]),a("div",ae,[a("p",null,c(e.$t("views.document.generateQuestion.tip1",{data:"{data}"})),1),a("p",null,c(e.$t("views.document.generateQuestion.tip2")+"<question></question>"+e.$t("views.document.generateQuestion.tip3")),1),a("p",null,c(e.$t("views.document.generateQuestion.tip4")),1)])]),l(u,{label:e.$t("views.application.applicationForm.form.aiModel.label"),prop:"model_id"},{default:p(()=>[l(m,{modelValue:t.value.model_id,"onUpdate:modelValue":o[0]||(o[0]=n=>t.value.model_id=n),placeholder:e.$t("views.application.applicationForm.form.aiModel.placeholder"),options:$.value},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"]),l(u,{label:e.$t("views.application.applicationForm.form.prompt.label"),prop:"prompt"},{default:p(()=>[l(D,{modelValue:t.value.prompt,"onUpdate:modelValue":o[1]||(o[1]=n=>t.value.prompt=n),placeholder:e.$t("views.application.applicationForm.form.prompt.placeholder"),rows:7,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"])}}});export{ie as _};
