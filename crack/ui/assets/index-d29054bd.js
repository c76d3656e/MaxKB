import{cr as te,dm as ne,cZ as le,cq as v,cs as m,c_ as ie,da as xe,cv as l,cy as _,cG as x,cB as n,cC as y,cA as o,cF as V,cL as k,cK as f,cR as Ie,dK as pe,dL as se,cO as L,de as ce,cN as j,cu as Ve,cS as Fe,cz as M,cD as ee,cE as ae,cw as De,cI as K,dq as Se,cM as oe,dM as Ne,cX as Ue,cY as Le,cP as Pe}from"./index-a6cfd98b.js";const Re={class:"dialog-footer"},qe=te({__name:"CopyApplicationDialog",setup(re,{expose:R}){const F=ne(),{common:g,user:B}=le(),D=v("views.application.applicationForm.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),S=m(),$=m(!1),d=m(!1),r=m({name:"",desc:"",model_id:"",dialogue_number:0,prologue:v("views.application.applicationForm.form.defaultPrologue"),dataset_id_list:[],dataset_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:D},problem_optimization:!1,type:"SIMPLE"}),h=ie({name:[{required:!0,message:v("views.application.applicationForm.form.appName.placeholder"),trigger:"blur"}]});xe(d,s=>{var i;s||(r.value={name:"",desc:"",model_id:"",dialogue_number:0,prologue:v("views.application.applicationForm.form.defaultPrologue"),dataset_id_list:[],dataset_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:D},problem_optimization:!1,type:"SIMPLE"},(i=S.value)==null||i.clearValidate())});const N=s=>{const i=Ie.cloneDeep(s);delete i.id,i.name=i.name+` ${v("views.application.applicationForm.title.copy")}`,r.value=i,d.value=!0},b=s=>{B.isEnterprise()?C(s):g.asyncGetValid(pe.Application,se.Application,$).then(async i=>{i!=null&&i.data,C(s)})},C=async s=>{s&&await s.validate(i=>{i&&L.postApplication(r.value,$).then(A=>{ce(v("common.createSuccess")),j(r.value.type)?F.push({path:`/application/${A.data.id}/workflow`}):F.push({path:`/application/${A.data.id}/${A.data.type}/setting`}),d.value=!1})})};return R({open:N}),(s,i)=>{const A=l("el-input"),q=l("el-form-item"),T=l("el-form"),z=l("el-button"),E=l("el-dialog");return _(),x(E,{title:s.$t("views.application.copyApplication"),modelValue:d.value,"onUpdate:modelValue":i[4]||(i[4]=w=>d.value=w),width:"650","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:n(()=>[y("span",Re,[o(z,{onClick:i[2]||(i[2]=V(w=>d.value=!1,["prevent"])),loading:$.value},{default:n(()=>[k(f(s.$t("common.cancel")),1)]),_:1},8,["loading"]),o(z,{type:"primary",onClick:i[3]||(i[3]=w=>b(S.value)),loading:$.value},{default:n(()=>[k(f(s.$t("common.copy")),1)]),_:1},8,["loading"])])]),default:n(()=>[o(T,{ref_key:"applicationFormRef",ref:S,model:r.value,rules:h,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[o(q,{label:s.$t("views.application.applicationForm.form.appName.label"),prop:"name"},{default:n(()=>[o(A,{modelValue:r.value.name,"onUpdate:modelValue":i[0]||(i[0]=w=>r.value.name=w),maxlength:"64",placeholder:s.$t("views.application.applicationForm.form.appName.placeholder"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(q,{label:s.$t("views.application.applicationForm.form.appDescription.label")},{default:n(()=>[o(A,{modelValue:r.value.desc,"onUpdate:modelValue":i[1]||(i[1]=w=>r.value.desc=w),type:"textarea",placeholder:s.$t("views.application.applicationForm.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),ze={class:"application-list-container p-24",style:{"padding-top":"16px"}},Me={class:"flex-between mb-16"},Be={class:"flex-between"},Te={class:"flex align-center cursor p-8"},Ee=["src"],Ge={class:"status-tag"},Oe={class:"footer-content"},He=te({__name:"index",setup(re){const R=m(),{application:F,user:g,common:B}=le(),D=ne(),S=m(),$=m(),d=m(!1),r=m([]),h=ie({current_page:1,page_size:30,total:0}),N=m([]),b=m("all"),C=m(""),s=m([]);function i(e){F.asyncGetApplicationDetail(e.id,d).then(a=>{a!=null&&a.data&&S.value.open({...a.data,model_id:a.data.model})})}const A=e=>g.userInfo?g.userInfo.id==e.user_id:!1;function q(e){j(e.type)?D.push({path:`/application/${e.id}/workflow`}):D.push({path:`/application/${e.id}/${e.type}/setting`})}const T=e=>{L.exportApplication(e.id,e.name,d).catch(a=>{a.response.status!==403&&a.response.data.text().then(p=>{Ue(`${v("views.application.tip.ExportError")}:${JSON.parse(p).message}`)})})},z=e=>{const a=new FormData;a.append("file",e.raw,e.name),R.value.clearFiles(),L.importApplication(a,d).then(async p=>{p!=null&&p.data&&w()}).catch(p=>{})};function E(){B.asyncGetValid(pe.Application,se.Application,d).then(async e=>{(e!=null&&e.data||(e==null?void 0:e.code)===400)&&$.value.open()})}function w(){g.userInfo&&localStorage.setItem(g.userInfo.id+"application",b.value),r.value=[],h.current_page=1,h.total=0,G()}function J(e){const a=new URLSearchParams;return e.forEach(p=>{a.append(encodeURIComponent(p.name),encodeURIComponent(p.value))}),a.toString()}function de(e){var p,I,U;(U=(I=(p=r.value.filter(c=>c.id===e)[0])==null?void 0:p.work_flow)==null?void 0:I.nodes)==null||U.filter(c=>c.id==="base-node").map(c=>{s.value=c.properties.api_input_field_list?c.properties.api_input_field_list.map(u=>({name:u.variable,value:u.default_value})):c.properties.input_field_list?c.properties.input_field_list.filter(u=>u.assignment_method==="api_input").map(u=>({name:u.variable,value:u.default_value})):[]});const a=J(s.value)?"?"+J(s.value):"";F.asyncGetAccessToken(e,d).then(c=>{var u;window.open(F.location+((u=c==null?void 0:c.data)==null?void 0:u.access_token)+a)})}function ue(e){Le(`${v("views.application.delete.confirmTitle")}${e.name} ?`,v("views.application.delete.confirmMessage"),{confirmButtonText:v("common.confirm"),cancelButtonText:v("common.cancel"),confirmButtonClass:"danger"}).then(()=>{L.delApplication(e.id,d).then(()=>{const a=r.value.findIndex(p=>p.id===e.id);r.value.splice(a,1),ce(v("common.deleteSuccess"))})}).catch(()=>{})}function G(){const e={...C.value&&{name:C.value},...b.value&&b.value!=="all"&&{select_user_id:b.value}};L.getApplication(h,e,d).then(a=>{a.data.records.forEach(p=>{var I;g.userInfo&&p.user_id===g.userInfo.id?p.username=g.userInfo.username:p.username=(I=N.value.find(U=>U.value===p.user_id))==null?void 0:I.label}),r.value=[...r.value,...a.data.records],h.total=a.data.total})}function me(){L.getUserList("APPLICATION",d).then(e=>{if(e.data){if(N.value=e.data.map(a=>({label:a.username,value:a.id})),g.userInfo){const a=localStorage.getItem(g.userInfo.id+"application");a&&N.value.find(p=>p.value===a)&&(b.value=a)}G()}})}return Ve(()=>{me()}),(e,a)=>{const p=l("el-option"),I=l("el-select"),U=l("el-input"),c=l("AppIcon"),u=l("el-divider"),_e=l("el-upload"),fe=l("el-card"),W=l("el-col"),X=l("AppAvatar"),ve=l("auto-tooltip"),ge=l("el-text"),Y=l("el-tag"),O=l("el-button"),Z=l("el-tooltip"),he=l("MoreFilled"),we=l("el-icon"),H=l("el-dropdown-item"),ye=l("el-dropdown-menu"),ke=l("el-dropdown"),be=l("CardBox"),$e=l("el-row"),Ce=l("InfiniteScroll"),Ae=Fe("loading");return _(),M("div",ze,[y("div",Me,[y("h4",null,f(e.$t("views.application.title")),1),y("div",Be,[o(I,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=t=>b.value=t),class:"mr-12",onChange:w,style:{"max-width":"240px",width:"150px"}},{default:n(()=>[(_(!0),M(ee,null,ae(N.value,t=>(_(),x(p,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(U,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=t=>C.value=t),onChange:w,placeholder:e.$t("views.application.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"min-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),De((_(),M("div",null,[o(Ce,{size:r.value.length,total:h.total,page_size:h.page_size,current_page:h.current_page,"onUpdate:current_page":a[5]||(a[5]=t=>h.current_page=t),onLoad:G,loading:d.value},{default:n(()=>[o($e,{gutter:15},{default:n(()=>[o(W,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[o(fe,{shadow:"hover",class:"application-card-add",style:{"--el-card-padding":"8px"}},{default:n(()=>[y("div",{class:"card-add-button flex align-center cursor p-8",onClick:E},[o(c,{iconName:"app-add-application",class:"mr-8"}),k(" "+f(e.$t("views.application.createApplication")),1)]),o(u,{style:{margin:"8px 0"}}),o(_e,{ref_key:"elUploadRef",ref:R,"file-list":[],action:"#",multiple:"","auto-upload":!1,"show-file-list":!1,limit:1,"on-change":(t,Q)=>z(t),class:"card-add-button"},{default:n(()=>[y("div",Te,[o(c,{iconName:"app-import",class:"mr-8"}),k(" "+f(e.$t("views.application.importApplication")),1)])]),_:1},8,["on-change"])]),_:1})]),_:1}),(_(!0),M(ee,null,ae(r.value,(t,Q)=>(_(),x(W,{xs:24,sm:12,md:8,lg:6,xl:6,key:Q,class:"mb-16"},{default:n(()=>[o(be,{title:t.name,description:t.desc,class:"application-card cursor",onClick:P=>K(D).push({path:`/application/${t.id}/${t.type}/overview`})},{icon:n(()=>[K(Se)(t==null?void 0:t.icon)?(_(),x(X,{key:0,shape:"square",size:32,style:{background:"none"},class:"mr-8"},{default:n(()=>[y("img",{src:t==null?void 0:t.icon,alt:""},null,8,Ee)]),_:2},1024)):t!=null&&t.name?(_(),x(X,{key:1,name:t==null?void 0:t.name,pinyinColor:"",shape:"square",size:32,class:"mr-8"},null,8,["name"])):oe("",!0)]),subTitle:n(()=>[o(ge,{class:"color-secondary",size:"small"},{default:n(()=>[o(ve,{content:t.username},{default:n(()=>[k(f(e.$t("common.creator"))+": "+f(t.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:n(()=>[y("div",Oe,[o(Z,{effect:"dark",content:e.$t("views.application.setting.demo"),placement:"top"},{default:n(()=>[o(O,{text:"",onClick:[a[2]||(a[2]=V(()=>{},["stop"])),P=>de(t.id)]},{default:n(()=>[o(c,{iconName:"app-view"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),o(u,{direction:"vertical"}),o(Z,{effect:"dark",content:e.$t("common.setting"),placement:"top"},{default:n(()=>[o(O,{text:"",onClick:V(P=>q(t),["stop"])},{default:n(()=>[o(c,{iconName:"Setting"})]),_:2},1032,["onClick"])]),_:2},1032,["content"]),o(u,{direction:"vertical"}),y("span",{onClick:a[4]||(a[4]=V(()=>{},["stop"]))},[o(ke,{trigger:"click"},{dropdown:n(()=>[o(ye,null,{default:n(()=>[A(t)?(_(),x(H,{key:0,onClick:P=>i(t)},{default:n(()=>[o(c,{iconName:"app-copy"}),k(" "+f(e.$t("common.copy")),1)]),_:2},1032,["onClick"])):oe("",!0),o(H,{onClick:V(P=>T(t),["stop"])},{default:n(()=>[o(c,{iconName:"app-export"}),k(" "+f(e.$t("common.export")),1)]),_:2},1032,["onClick"]),o(H,{icon:"Delete",onClick:V(P=>ue(t),["stop"])},{default:n(()=>[k(f(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[o(O,{text:"",onClick:a[3]||(a[3]=V(()=>{},["stop"]))},{default:n(()=>[o(we,null,{default:n(()=>[o(he)]),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[y("div",Ge,[K(j)(t.type)?(_(),x(Y,{key:0,type:"warning",style:{height:"22px"}},{default:n(()=>[k(f(e.$t("views.application.workflow")),1)]),_:1})):(_(),x(Y,{key:1,class:"blue-tag",style:{height:"22px"}},{default:n(()=>[k(f(e.$t("views.application.simple")),1)]),_:1}))])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[Ae,h.current_page===1&&d.value,void 0,{fullscreen:!0,lock:!0}]]),o(Ne,{ref_key:"CreateApplicationDialogRef",ref:$},null,512),o(qe,{ref_key:"CopyApplicationDialogRef",ref:S},null,512)])}}});const je=Pe(He,[["__scopeId","data-v-4e0134de"]]);export{je as default};
