import{cr as W,dk as X,cZ as Y,cs as n,da as ee,e3 as j,cu as le,e4 as ae,cv as s,cS as te,cy as f,cz as S,cC as P,cK as k,cA as a,cB as o,cw as oe,cG as E,cD as G,cE as Z,cL as V,cM as q,dd as ne,cP as se,cR as O,e5 as ce,cF as J,cI as Q}from"./index-a6cfd98b.js";import{_ as re}from"./ParagraphForm.vue_vue_type_script_setup_true_lang-be0b3f51.js";const de={class:"bold title p-24",style:{"padding-bottom":"0"}},ie={class:"flex align-center"},ue={class:"p-24",style:{"padding-top":"16px"}},pe=W({__name:"ProblemComponent",props:{problemId:String,docId:String,datasetId:String},setup(F,{expose:M}){const l=F,N=X(),{params:{id:y,documentId:I}}=N,{problem:C}=Y(),L=n(),v=n(!1),p=n(!1),m=n(""),i=n([]),u=n([]),g=n(!1);ee(()=>l.problemId,e=>{e&&h()},{immediate:!0});function b(e,c){e.id?C.asyncDisassociationProblem(l.datasetId||y,I||l.docId,l.problemId||"",e.id,v).then(t=>{h()}):i.value.splice(c,1)}function h(){v.value=!0,j.getProblem(l.datasetId||y,I||l.docId,l.problemId||"").then(e=>{i.value=e.data,v.value=!1}).catch(()=>{v.value=!1})}function w(){p.value=!0,ne(()=>{var e;(e=L.value)==null||e.focus()})}function D(e){if(l.problemId)(u.value.some(t=>t.id===e)?C.asyncAssociationProblem(l.datasetId||y,I||l.docId,l.problemId,e,v):j.postProblem(l.datasetId||y,I||l.docId,l.problemId,{content:e},v)).then(()=>{h(),m.value="",p.value=!1});else{const c=u.value.find(r=>r.id===e),t=c?c.content:e;i.value.some(r=>r.content===t)||i.value.push({content:t}),m.value="",p.value=!1}}const H=e=>{R(e)};function R(e){return C.asyncGetProblem(l.datasetId||y,{current_page:1,page_size:100},e&&{content:e},g).then(c=>{u.value=c.data.records})}return le(()=>{R()}),ae(()=>{i.value=[],m.value="",p.value=!1}),M({problemList:i}),(e,c)=>{const t=s("el-divider"),r=s("Plus"),$=s("el-icon"),x=s("el-button"),_=s("el-option"),B=s("el-select"),A=s("auto-tooltip"),T=s("TagEllipsis"),U=s("el-scrollbar"),z=te("loading");return f(),S(G,null,[P("p",de,[P("span",ie,[P("span",null,k(e.$t("views.paragraph.relatedProblem.title")),1),a(t,{direction:"vertical",class:"mr-4"}),a(x,{text:"",onClick:w},{default:o(()=>[a($,null,{default:o(()=>[a(r)]),_:1})]),_:1})])]),oe((f(),S("div",null,[a(U,{height:"500px"},{default:o(()=>[P("div",ue,[p.value?(f(),E(B,{key:0,modelValue:m.value,"onUpdate:modelValue":c[0]||(c[0]=d=>m.value=d),filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:e.$t("views.paragraph.relatedProblem.placeholder"),remote:"","remote-method":H,loading:g.value,onChange:D,onBlur:c[1]||(c[1]=d=>p.value=!1),class:"mb-16","popper-class":"select-popper","popper-append-to-body":!1},{default:o(()=>[(f(!0),S(G,null,Z(u.value,d=>(f(),E(_,{key:d.id,label:d.content,value:d.id},{default:o(()=>[V(k(d.content),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","placeholder","loading"])):q("",!0),(f(!0),S(G,null,Z(i.value,(d,K)=>(f(),E(T,{key:K,onClose:ge=>b(d,K),class:"question-tag",type:"info",effect:"plain",closable:""},{default:o(()=>[a(A,{content:d.content},{default:o(()=>[V(k(d.content),1)]),_:2},1032,["content"])]),_:2},1032,["onClose"]))),128))])]),_:1})])),[[z,v.value]])],64)}}});const me=se(pe,[["__scopeId","data-v-3e499cdc"]]),ve={class:"p-24",style:{"padding-bottom":"8px"}},_e={style:{position:"absolute",right:"20px",top:"20px"}},fe={key:0,class:"text-right p-24 pt-0"},be={class:"dialog-footer"},Ie=W({__name:"ParagraphDialog",props:{title:String},emits:["refresh"],setup(F,{expose:M,emit:l}){const{paragraph:N}=Y(),y=X(),{params:{id:I,documentId:C}}=y,L=l,v=n(),p=n(),m=n(!1),i=n(!1),u=n(""),g=n({}),b=n(!1),h=n(""),w=n(""),D=n(null);ee(m,t=>{t||(u.value="",g.value={},b.value=!1,h.value="",w.value="",D.value=null)});const H=()=>{b.value=!1,g.value=O.cloneDeep(D.value)},R=t=>{t?(g.value.title=t.title,g.value.content=t.content,D.value=O.cloneDeep(g.value),u.value=t.id,h.value=t.document_id,w.value=t.dataset_id||I):b.value=!0,m.value=!0},e=async()=>{var t,r,$,x;if(await((t=p.value)==null?void 0:t.validate()))if(i.value=!0,u.value)N.asyncPutParagraph(w.value,C||h.value,u.value,(r=p.value)==null?void 0:r.form,i).then(_=>{b.value=!1,L("refresh",_.data)});else{const _=v.value.problemList.length>0?{problem_list:v.value.problemList,...($=p.value)==null?void 0:$.form}:(x=p.value)==null?void 0:x.form;j.postParagraph(I,C,_,i).then(B=>{m.value=!1,L("refresh")})}},c=O.debounce(()=>{e()},200);return M({open:R}),(t,r)=>{const $=s("EditPen"),x=s("el-icon"),_=s("el-button"),B=s("el-scrollbar"),A=s("el-col"),T=s("el-row"),U=s("el-dialog"),z=te("loading");return f(),E(U,{title:F.title,modelValue:m.value,"onUpdate:modelValue":r[2]||(r[2]=d=>m.value=d),width:"80%",class:"paragraph-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},ce({default:o(()=>[oe((f(),E(T,null,{default:o(()=>[a(A,{span:18},{default:o(()=>[a(B,{height:"500","wrap-class":"paragraph-scrollbar"},{default:o(()=>[P("div",ve,[P("div",_e,[u.value&&!b.value?(f(),E(_,{key:0,text:"",onClick:r[0]||(r[0]=d=>b.value=!0)},{default:o(()=>[a(x,null,{default:o(()=>[a($)]),_:1})]),_:1})):q("",!0)]),a(re,{ref_key:"paragraphFormRef",ref:p,data:g.value,isEdit:b.value},null,8,["data","isEdit"])])]),_:1}),u.value&&b.value?(f(),S("div",fe,[a(_,{onClick:J(H,["prevent"])},{default:o(()=>[V(k(t.$t("common.cancel")),1)]),_:1}),a(_,{type:"primary",disabled:i.value,onClick:Q(c)},{default:o(()=>[V(k(t.$t("common.save")),1)]),_:1},8,["disabled","onClick"])])):q("",!0)]),_:1}),a(A,{span:6,class:"border-l",style:{width:"300px"}},{default:o(()=>[a(me,{problemId:u.value,docId:h.value,datasetId:w.value,ref_key:"ProblemRef",ref:v},null,8,["problemId","docId","datasetId"])]),_:1})]),_:1})),[[z,i.value]])]),_:2},[u.value?void 0:{name:"footer",fn:o(()=>[P("span",be,[a(_,{onClick:r[1]||(r[1]=J(d=>m.value=!1,["prevent"]))},{default:o(()=>[V(k(t.$t("common.cancel")),1)]),_:1}),a(_,{disabled:i.value,type:"primary",onClick:Q(c)},{default:o(()=>[V(k(t.$t("common.submit")),1)]),_:1},8,["disabled","onClick"])])]),key:"0"}]),1032,["title","modelValue"])}}});export{Ie as _};
