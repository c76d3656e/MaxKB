import{cr as ue,cZ as pe,dm as _e,cs as g,c_ as fe,cu as me,cv as s,cS as ve,cy as i,cz as S,cC as c,cK as l,cA as o,cB as n,cD as F,cE as q,cG as h,cw as ge,cI as B,di as he,dj as ye,cL as d,dV as Ce,cF as y,cM as W,e8 as we,dK as ke,dL as xe,de as k,cq as u,e1 as x,cY as $e,cO as be,cP as De}from"./index-a6cfd98b.js";import{S as Se}from"./SyncWebDialog-5de1c71b.js";const Ie={class:"dataset-list-container p-24",style:{"padding-top":"16px"}},Ve={class:"flex-between mb-16"},Ae={class:"flex-between"},ze={class:"delete-button"},Be={class:"footer-content flex-between"},Me={class:"bold"},Le={class:"bold"},Re={class:"bold"},Ee=ue({__name:"index",setup(Ne){const{user:f,common:Z}=pe(),M=_e(),I=g(),L=g(),p=g(!1),m=g([]),_=fe({current_page:1,page_size:30,total:0}),$=g(""),b=g([]),v=g("all");function G(){Z.asyncGetValid(ke.Dataset,xe.Dataset,p).then(async e=>{(e!=null&&e.data||(e==null?void 0:e.code)===400)&&I.value.open()})}function K(){k(u("views.dataset.tip.syncSuccess"))}function O(e){x.putReEmbeddingDataset(e.id).then(()=>{k(u("common.submitSuccess"))})}function P(e){L.value.open(e.id)}function R(){f.userInfo&&localStorage.setItem(f.userInfo.id+"dataset",v.value),_.current_page=1,m.value=[],V()}const j=e=>{x.exportDataset(e.name,e.id,p).then(a=>{k(u("common.exportSuccess"))})},H=e=>{x.exportZipDataset(e.name,e.id,p).then(a=>{k(u("common.exportSuccess"))})};function Y(e){$e(`${u("views.dataset.delete.confirmTitle")}${e.name} ?`,`${u("views.dataset.delete.confirmMessage1")} ${e.application_mapping_count} ${u("views.dataset.delete.confirmMessage2")}`,{confirmButtonText:u("common.delete"),confirmButtonClass:"danger"}).then(()=>{x.delDataset(e.id,p).then(()=>{const a=m.value.findIndex(r=>r.id===e.id);m.value.splice(a,1),k(u("common.deleteSuccess"))})}).catch(()=>{})}function V(){const e={...$.value&&{name:$.value},...v.value&&v.value!=="all"&&{select_user_id:v.value}};x.getDataset(_,e,p).then(a=>{a.data.records.forEach(r=>{var D;f.userInfo&&r.user_id===f.userInfo.id?r.username=f.userInfo.username:r.username=(D=b.value.find(A=>A.value===r.user_id))==null?void 0:D.label}),_.total=a.data.total,m.value=[...m.value,...a.data.records]})}function J(){be.getUserList("DATASET",p).then(e=>{if(e.data){if(b.value=e.data.map(a=>({label:a.username,value:a.id})),f.userInfo){const a=localStorage.getItem(f.userInfo.id+"dataset");a&&b.value.find(r=>r.value===a)&&(v.value=a)}V()}})}return me(()=>{J()}),(e,a)=>{const r=s("el-option"),D=s("el-select"),A=s("el-input"),Q=s("CardAdd"),E=s("el-col"),N=s("AppAvatar"),X=s("auto-tooltip"),ee=s("el-text"),T=s("el-tag"),U=s("el-divider"),te=s("MoreFilled"),ae=s("el-icon"),oe=s("el-button"),C=s("el-dropdown-item"),z=s("AppIcon"),ne=s("el-dropdown-menu"),se=s("el-dropdown"),le=s("CardBox"),ce=s("el-row"),de=s("InfiniteScroll"),ie=ve("loading");return i(),S("div",Ie,[c("div",Ve,[c("h4",null,l(e.$t("views.dataset.title")),1),c("div",Ae,[o(D,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=t=>v.value=t),class:"mr-12",onChange:R,style:{"max-width":"240px",width:"150px"}},{default:n(()=>[(i(!0),S(F,null,q(b.value,t=>(i(),h(r,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(A,{modelValue:$.value,"onUpdate:modelValue":a[1]||(a[1]=t=>$.value=t),onChange:R,placeholder:e.$t("views.dataset.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",style:{"max-width":"240px"},clearable:""},null,8,["modelValue","placeholder"])])]),ge((i(),S("div",null,[o(de,{size:m.value.length,total:_.total,page_size:_.page_size,current_page:_.current_page,"onUpdate:current_page":a[4]||(a[4]=t=>_.current_page=t),onLoad:V,loading:p.value},{default:n(()=>[o(ce,{gutter:15},{default:n(()=>[o(E,{xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[o(Q,{title:e.$t("views.dataset.createDataset"),onClick:G},null,8,["title"])]),_:1}),(i(!0),S(F,null,q(m.value,(t,re)=>(i(),h(E,{key:re,xs:24,sm:12,md:8,lg:6,xl:6,class:"mb-16"},{default:n(()=>[o(le,{title:t.name,description:t.desc,class:"cursor",onClick:w=>B(M).push({path:`/dataset/${t.id}/document`})},{icon:n(()=>[t.type==="1"?(i(),h(N,{key:0,class:"mr-8 avatar-purple",shape:"square",size:32},{default:n(()=>a[5]||(a[5]=[c("img",{src:he,style:{width:"58%"},alt:""},null,-1)])),_:1})):(i(),h(N,{key:1,class:"mr-8 avatar-blue",shape:"square",size:32},{default:n(()=>a[6]||(a[6]=[c("img",{src:ye,style:{width:"58%"},alt:""},null,-1)])),_:1}))]),subTitle:n(()=>[o(ee,{class:"color-secondary",size:"small"},{default:n(()=>[o(X,{content:t.username},{default:n(()=>[d(l(e.$t("common.creator"))+": "+l(t.username),1)]),_:2},1032,["content"])]),_:2},1024)]),footer:n(()=>[c("div",Be,[c("div",null,[c("span",Me,l((t==null?void 0:t.document_count)||0),1),d(" "+l(e.$t("views.dataset.document_count")),1),o(U,{direction:"vertical"}),c("span",Le,l(B(Ce)(t==null?void 0:t.char_length)||0),1),d(" "+l(e.$t("common.character")),1),o(U,{direction:"vertical"}),c("span",Re,l((t==null?void 0:t.application_mapping_count)||0),1),d(" "+l(e.$t("views.dataset.relatedApp_count")),1)]),c("div",{onClick:a[3]||(a[3]=y(()=>{},["stop"]))},[o(se,{trigger:"click"},{dropdown:n(()=>[o(ne,null,{default:n(()=>[t.type==="1"?(i(),h(C,{key:0,icon:"Refresh",onClick:y(w=>P(t),["stop"])},{default:n(()=>[d(l(e.$t("views.dataset.setting.sync")),1)]),_:2},1032,["onClick"])):W("",!0),o(C,{onClick:w=>O(t)},{default:n(()=>[o(z,{iconName:"app-document-refresh",style:{"font-size":"16px"}}),d(" "+l(e.$t("views.dataset.setting.vectorization")),1)]),_:2},1032,["onClick"]),o(C,{icon:"Setting",onClick:y(w=>B(M).push({path:`/dataset/${t.id}/setting`}),["stop"])},{default:n(()=>[d(l(e.$t("common.setting")),1)]),_:2},1032,["onClick"]),o(C,{onClick:y(w=>j(t),["stop"])},{default:n(()=>[o(z,{iconName:"app-export"}),d(l(e.$t("common.export"))+"Excel",1)]),_:2},1032,["onClick"]),o(C,{onClick:y(w=>H(t),["stop"])},{default:n(()=>[o(z,{iconName:"app-export"}),d(l(e.$t("common.export"))+"ZIP",1)]),_:2},1032,["onClick"]),o(C,{icon:"Delete",onClick:y(w=>Y(t),["stop"])},{default:n(()=>[d(l(e.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[o(oe,{text:"",onClick:a[2]||(a[2]=y(()=>{},["stop"]))},{default:n(()=>[o(ae,null,{default:n(()=>[o(te)]),_:1})]),_:1})]),_:2},1024)])])]),default:n(()=>[c("div",ze,[t.type==="0"?(i(),h(T,{key:0,class:"blue-tag",style:{height:"22px"}},{default:n(()=>[d(l(e.$t("views.dataset.general")),1)]),_:1})):t.type==="1"?(i(),h(T,{key:1,class:"purple-tag",type:"warning",style:{height:"22px"}},{default:n(()=>[d(l(e.$t("views.dataset.web")),1)]),_:1})):W("",!0)])]),_:2},1032,["title","description","onClick"])]),_:2},1024))),128))]),_:1})]),_:1},8,["size","total","page_size","current_page","loading"])])),[[ie,_.current_page===1&&p.value,void 0,{fullscreen:!0,lock:!0}]]),o(Se,{ref_key:"SyncWebDialogRef",ref:L,onRefresh:K},null,512),o(we,{ref_key:"CreateDatasetDialogRef",ref:I},null,512)])}}});const Fe=De(Ee,[["__scopeId","data-v-a6c321d6"]]);export{Fe as default};
