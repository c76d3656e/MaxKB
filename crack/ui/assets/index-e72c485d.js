import{cr as O,cs as m,c_ as E,cq as u,da as Q,cv as r,cy as S,cG as D,cB as s,cC as h,cA as l,cF as U,cL as C,cK as y,cM as W,el as F,de as L,cZ as X,cu as x,cS as ee,cw as le,cI as ae,dl as oe,em as se,dK as te,dL as ne,cY as re,cP as ue}from"./index-a6cfd98b.js";const ie={class:"dialog-footer"},me=O({__name:"UserDialog",props:{title:String},emits:["refresh"],setup(z,{expose:q,emit:I}){const g=I,w=m(),o=m({username:"",email:"",password:"",phone:"",nick_name:""}),v=E({username:[{required:!0,message:u("views.user.userForm.form.username.requiredMessage"),trigger:"blur"},{min:6,max:20,message:u("views.user.userForm.form.username.lengthMessage"),trigger:"blur"}],email:[{required:!0,message:u("views.user.userForm.form.email.requiredMessage"),trigger:"blur"}],password:[{required:!0,message:u("views.user.userForm.form.password.requiredMessage"),trigger:"blur"},{min:6,max:20,message:u("views.user.userForm.form.password.lengthMessage"),trigger:"blur"}]}),i=m(!1),b=m(!1),d=m(!1);Q(i,a=>{var t;a||(o.value={username:"",email:"",password:"",phone:"",nick_name:""},d.value=!1,(t=w.value)==null||t.clearValidate())});const A=a=>{a&&(o.value.id=a.id,o.value.username=a.username,o.value.email=a.email,o.value.password=a.password,o.value.phone=a.phone,o.value.nick_name=a.nick_name,d.value=!0),i.value=!0},P=async a=>{a&&await a.validate((t,_)=>{t&&(d.value?F.putUserManage(o.value.id,o.value,b).then(p=>{g("refresh"),L(u("common.editSuccess")),i.value=!1}):F.postUserManage(o.value,b).then(p=>{g("refresh"),L(u("common.createSuccess")),i.value=!1}))})};return q({open:A}),(a,t)=>{const _=r("el-input"),p=r("el-form-item"),R=r("el-form"),c=r("el-button"),M=r("el-dialog");return S(),D(M,{title:z.title,modelValue:i.value,"onUpdate:modelValue":t[8]||(t[8]=e=>i.value=e),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:s(()=>[h("span",ie,[l(c,{onClick:t[6]||(t[6]=U(e=>i.value=!1,["prevent"]))},{default:s(()=>[C(y(a.$t("common.cancel")),1)]),_:1}),l(c,{type:"primary",onClick:t[7]||(t[7]=e=>P(w.value)),loading:b.value},{default:s(()=>[C(y(a.$t("common.save")),1)]),_:1},8,["loading"])])]),default:s(()=>[l(R,{ref_key:"userFormRef",ref:w,model:o.value,rules:v,"label-position":"top","require-asterisk-position":"right",onSubmit:t[5]||(t[5]=U(()=>{},["prevent"])),"close-on-click-modal":!1,"close-on-press-escape":!1},{default:s(()=>[l(p,{prop:d.value?"":"username",label:a.$t("views.user.userForm.form.username.label")},{default:s(()=>[l(_,{modelValue:o.value.username,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value.username=e),placeholder:a.$t("views.user.userForm.form.username.placeholder"),maxlength:"20","show-word-limit":"",disabled:d.value},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["prop","label"]),l(p,{label:a.$t("views.user.userForm.form.nick_name.label")},{default:s(()=>[l(_,{modelValue:o.value.nick_name,"onUpdate:modelValue":t[1]||(t[1]=e=>o.value.nick_name=e),placeholder:a.$t("views.user.userForm.form.nick_name.placeholder"),maxlength:"64","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("views.user.userForm.form.email.label"),prop:"email"},{default:s(()=>[l(_,{type:"email",modelValue:o.value.email,"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.email=e),placeholder:a.$t("views.user.userForm.form.email.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:a.$t("views.user.userForm.form.phone.label")},{default:s(()=>[l(_,{modelValue:o.value.phone,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value.phone=e),placeholder:a.$t("views.user.userForm.form.phone.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),d.value?W("",!0):(S(),D(p,{key:0,label:a.$t("views.user.userForm.form.password.label"),prop:"password"},{default:s(()=>[l(_,{type:"password",modelValue:o.value.password,"onUpdate:modelValue":t[4]||(t[4]=e=>o.value.password=e),placeholder:a.$t("views.user.userForm.form.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]))]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}}),de={class:"p-24"},ce={class:"flex-between"},pe={class:"mr-4"},fe={class:"mr-4"},ve={class:"mr-4"},_e=O({__name:"index",setup(z){const{common:q,user:I}=X(),g=m(),w=m(),o=m(""),v=m(!1),i=E({current_page:1,page_size:20,total:0}),b=m([]),d=m("");function A(){i.total=0,i.current_page=1,b.value=[],c()}function P(e,$){const k={is_active:e},B=e?u("common.status.enableSuccess"):u("common.status.disableSuccess");F.putUserManage($.id,k,v).then(f=>{c(),L(B)})}function a(e){w.value.open(e)}function t(e){o.value=u("views.user.editUser"),g.value.open(e)}function _(){q.asyncGetValid(te.User,ne.User,v).then(async e=>{e!=null&&e.data?(o.value=u("views.user.createUser"),g.value.open()):(e==null?void 0:e.code)===400&&(o.value=u("views.user.createUser"),g.value.open())})}function p(e){re(`${u("views.user.delete.confirmTitle")}${e.username} ?`,u("views.user.delete.confirmMessage"),{confirmButtonText:u("common.delete"),confirmButtonClass:"danger"}).then(()=>{v.value=!0,F.delUserManage(e.id,v).then(()=>{L(u("common.deleteSuccess")),c()})}).catch(()=>{})}function R(){i.current_page=1,c()}function c(){return F.getUserManage(i,d.value,v).then(e=>{b.value=e.data.records,i.total=e.data.total})}function M(){c()}return x(()=>{c()}),(e,$)=>{const k=r("el-button"),B=r("el-input"),f=r("el-table-column"),G=r("el-switch"),H=r("EditPen"),N=r("el-icon"),T=r("el-tooltip"),K=r("Lock"),j=r("Delete"),Y=r("app-table"),Z=r("LayoutContainer"),J=ee("loading");return S(),D(Z,{header:e.$t("views.user.title")},{default:s(()=>[h("div",de,[h("div",ce,[l(k,{type:"primary",onClick:_},{default:s(()=>[C(y(e.$t("views.user.createUser")),1)]),_:1}),l(B,{modelValue:d.value,"onUpdate:modelValue":$[0]||($[0]=n=>d.value=n),onChange:A,placeholder:e.$t("common.search"),"prefix-icon":"Search",class:"w-240",clearable:""},null,8,["modelValue","placeholder"])]),le((S(),D(Y,{class:"mt-16",data:b.value,"pagination-config":i,onSizeChange:R,onChangePage:c},{default:s(()=>[l(f,{prop:"username",label:e.$t("views.user.userForm.form.username.label")},null,8,["label"]),l(f,{prop:"nick_name",label:e.$t("views.user.userForm.form.nick_name.label")},null,8,["label"]),l(f,{prop:"email",label:e.$t("views.user.userForm.form.email.label"),"show-overflow-tooltip":""},null,8,["label"]),l(f,{prop:"phone",label:e.$t("views.user.userForm.form.phone.label")},null,8,["label"]),l(f,{prop:"source",label:e.$t("views.user.source.label")},{default:s(({row:n})=>[C(y(n.source==="LOCAL"?e.$t("views.user.source.local"):n.source==="wecom"?e.$t("views.user.source.wecom"):n.source==="lark"?e.$t("views.user.source.lark"):n.source==="dingtalk"?e.$t("views.user.source.dingtalk"):n.source==="OAUTH2"||n.source==="OAuth2"?"OAuth2":n.source),1)]),_:1},8,["label"]),l(f,{label:e.$t("common.status.label"),width:"80"},{default:s(({row:n})=>[h("div",{onClick:$[1]||($[1]=U(()=>{},["stop"]))},[l(G,{disabled:n.role==="ADMIN",size:"small",modelValue:n.is_active,"onUpdate:modelValue":V=>n.is_active=V,onChange:V=>P(V,n)},null,8,["disabled","modelValue","onUpdate:modelValue","onChange"])])]),_:1},8,["label"]),l(f,{label:e.$t("common.createTime"),width:"180"},{default:s(({row:n})=>[C(y(ae(oe)(n.create_time)),1)]),_:1},8,["label"]),l(f,{label:e.$t("common.operation"),width:"110",align:"left",fixed:"right"},{default:s(({row:n})=>[h("span",pe,[l(T,{effect:"dark",content:e.$t("common.edit"),placement:"top"},{default:s(()=>[l(k,{type:"primary",text:"",onClick:U(V=>t(n),["stop"])},{default:s(()=>[l(N,null,{default:s(()=>[l(H)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),h("span",fe,[l(T,{effect:"dark",content:e.$t("views.user.setting.updatePwd"),placement:"top"},{default:s(()=>[l(k,{type:"primary",text:"",onClick:U(V=>a(n),["stop"])},{default:s(()=>[l(N,null,{default:s(()=>[l(K)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),h("span",ve,[l(T,{effect:"dark",content:e.$t("common.delete"),placement:"top"},{default:s(()=>[l(k,{disabled:n.role==="ADMIN",type:"primary",text:"",onClick:U(V=>p(n),["stop"])},{default:s(()=>[l(N,null,{default:s(()=>[l(j)]),_:1})]),_:2},1032,["disabled","onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config"])),[[J,v.value]])]),l(me,{title:o.value,ref_key:"UserDialogRef",ref:g,onRefresh:M},null,8,["title"]),l(se,{ref_key:"UserPwdDialogRef",ref:w,onRefresh:M},null,512)]),_:1},8,["header"])}}});const be=ue(_e,[["__scopeId","data-v-8718a3d1"]]);export{be as default};
