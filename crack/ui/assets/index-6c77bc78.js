import{cr as se,dk as ie,cZ as ce,cs as u,c_ as fe,cq as M,da as J,cv as s,cy as P,cG as S,cB as l,cC as g,cA as t,cF as G,cL as C,cK as v,de as j,cS as ge,e5 as De,cw as be,cM as Re,cz as he,cD as $e,cE as ye,cU as Ve,ef as Q,e3 as Me,cX as Pe,ct as ve,cu as Se,dp as Ie,cI as Ce,dl as ke,cY as xe}from"./index-a6cfd98b.js";import{_ as ze}from"./ParagraphDialog.vue_vue_type_script_setup_true_lang-fc9285e5.js";import"./ParagraphForm.vue_vue_type_script_setup_true_lang-be0b3f51.js";const Be={class:"dialog-footer"},qe=se({__name:"CreateProblemDialog",emits:["refresh"],setup(ee,{expose:H,emit:I}){const w=ie(),{params:{id:x}}=w,{problem:U}=ce(),D=I,R=u(),k=u(!1),d=u({data:""}),m=fe({data:[{required:!0,message:M("views.problem.tip.requiredMessage"),trigger:"blur"}]}),i=u(!1);J(i,h=>{h||(d.value={data:""})});const b=()=>{i.value=!0},_=async h=>{h&&await h.validate((p,f)=>{if(p){const V=d.value.data.split(`
`).filter(function($){return $!==""});U.asyncPostProblem(x,V,k).then($=>{j(M("common.createSuccess")),D("refresh"),i.value=!1})}})};return H({open:b}),(h,p)=>{const f=s("el-input"),V=s("el-form-item"),$=s("el-form"),z=s("el-button"),q=s("el-dialog");return P(),S(q,{title:h.$t("views.problem.createProblem"),modelValue:i.value,"onUpdate:modelValue":p[3]||(p[3]=r=>i.value=r),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:l(()=>[g("span",Be,[t(z,{onClick:p[1]||(p[1]=G(r=>i.value=!1,["prevent"]))},{default:l(()=>[C(v(h.$t("common.cancel")),1)]),_:1}),t(z,{type:"primary",onClick:p[2]||(p[2]=r=>_(R.value)),loading:k.value},{default:l(()=>[C(v(h.$t("common.confirm")),1)]),_:1},8,["loading"])])]),default:l(()=>[t($,{"label-position":"top",ref_key:"problemFormRef",ref:R,rules:m,model:d.value,"require-asterisk-position":"right"},{default:l(()=>[t(V,{label:h.$t("views.problem.title"),prop:"data"},{default:l(()=>[t(f,{modelValue:d.value.data,"onUpdate:modelValue":p[0]||(p[0]=r=>d.value.data=r),placeholder:h.$t("views.problem.tip.placeholder"),rows:10,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Le={class:"bold title align-center p-24 pb-0"},Ue={class:"p-8",style:{"padding-bottom":"8px"}},Ae={class:"flex lighter align-center"},Ne={class:"p-24",style:{"padding-bottom":"8px","padding-top":"16px"}},Te={class:"flex-between mb-16"},Ee={class:"bold title align-center"},Fe={class:"dialog-footer"},we=se({__name:"RelateProblemDialog",emits:["refresh"],setup(ee,{expose:H,emit:I}){const{problem:w,document:x}=ce(),U=ie(),{params:{id:D}}=U,R=I,k=u(!1),d=u(!1),m=u([]),i=u([]),b=u([]),_=u(""),h=u([]),p=u([]),f=u(""),V=u(""),$=u("title"),z=u(""),q=u(!1),r=fe({current_page:1,page_size:50,total:0});function B(){const a={problem_id_list:h.value,paragraph_list:p.value.map(o=>({paragraph_id:o.id,document_id:o.document_id}))};Q.postMulAssociationProblem(D,a,d).then(()=>{j(M("views.problem.tip.relatedSuccess")),k.value=!1})}function X(a){q.value?E(a.id)?p.value.splice(p.value.indexOf(a.id),1):p.value.push(a):E(a.id)?w.asyncDisassociationProblem(D,a.document_id,a.id,_.value,d).then(()=>{T(_.value)}):w.asyncAssociationProblem(D,a.document_id,a.id,_.value,d).then(()=>{T(_.value)})}function K(){r.current_page=1,b.value=[],f.value&&N(f.value)}function Y(a){r.current_page=1,b.value=[],f.value=a.id,N(a.id)}function A(){x.asyncGetAllDocument(D,d).then(a=>{var o;i.value=a.data,m.value=a.data,f.value=((o=i.value)==null?void 0:o.length)>0?i.value[0].id:"",f.value&&N(f.value)})}function N(a){Me.getParagraph(D,a||f.value,r,V.value&&{[$.value]:V.value},d).then(o=>{b.value=[...b.value,...o.data.records],r.total=o.data.total})}function T(a){Q.getDetailProblems(D,a,d).then(o=>{p.value=o.data})}function W(a){return p.value.filter(o=>o.document_id===a).length}function E(a){return p.value.some(o=>o.id===a)}return J(k,a=>{a||(m.value=[],i.value=[],b.value=[],p.value=[],q.value=!1,f.value="",V.value="",$.value="title",R("refresh"))}),J(z,a=>{var o;b.value=[],m.value=a?i.value.filter(L=>L.name.includes(a)):i.value,f.value=((o=m.value)==null?void 0:o.length)>0?m.value[0].id:""}),H({open:a=>{A(),a.length==1?(_.value=a[0],T(a)):a.length>1&&(h.value=a,q.value=!0),k.value=!0}}),(a,o)=>{const L=s("el-input"),Z=s("auto-tooltip"),e=s("el-badge"),c=s("common-list"),y=s("el-scrollbar"),le=s("el-col"),F=s("el-text"),ae=s("el-option"),ue=s("el-select"),de=s("el-empty"),oe=s("CardBox"),ne=s("InfiniteScroll"),pe=s("el-row"),re=s("el-button"),me=s("el-dialog"),_e=ge("loading");return P(),S(me,{title:a.$t("views.problem.relateParagraph.title"),modelValue:k.value,"onUpdate:modelValue":o[5]||(o[5]=n=>k.value=n),width:"80%",class:"paragraph-dialog","destroy-on-close":"","close-on-click-modal":!1,"close-on-press-escape":!1},De({default:l(()=>[be((P(),S(pe,null,{default:l(()=>[t(le,{span:6},{default:l(()=>[t(y,{height:"500","wrap-class":"paragraph-scrollbar"},{default:l(()=>[g("div",Le,v(a.$t("views.problem.relateParagraph.selectDocument")),1),g("div",Ue,[t(L,{modelValue:z.value,"onUpdate:modelValue":o[0]||(o[0]=n=>z.value=n),placeholder:a.$t("views.problem.relateParagraph.placeholder"),"prefix-icon":"Search",clearable:""},null,8,["modelValue","placeholder"]),t(c,{data:m.value,class:"mt-8",onClick:Y,"default-active":f.value},{default:l(({row:n})=>[g("span",Ae,[t(Z,{content:n.name},{default:l(()=>[C(v(n.name),1)]),_:2},1032,["content"]),W(n.id)?(P(),S(e,{key:0,value:W(n.id),type:"primary",class:"paragraph-badge ml-4"},null,8,["value"])):Re("",!0)])]),_:1},8,["data","default-active"])])]),_:1})]),_:1}),t(le,{span:18,class:"border-l"},{default:l(()=>[t(y,{height:"500","wrap-class":"paragraph-scrollbar"},{default:l(()=>[g("div",Ne,[g("div",Te,[g("div",Ee,[C(v(a.$t("views.problem.relateParagraph.selectParagraph"))+" ",1),t(F,null,{default:l(()=>[C(" （"+v(a.$t("views.problem.relateParagraph.selectedParagraph"))+"："+v(W(f.value))+" "+v(a.$t("views.problem.relateParagraph.count"))+"） ",1)]),_:1})]),t(L,{modelValue:V.value,"onUpdate:modelValue":o[2]||(o[2]=n=>V.value=n),placeholder:a.$t("common.search"),class:"input-with-select",style:{width:"260px"},onChange:K},{prepend:l(()=>[t(ue,{modelValue:$.value,"onUpdate:modelValue":o[1]||(o[1]=n=>$.value=n),placeholder:"Select",style:{width:"80px"}},{default:l(()=>[t(ae,{label:a.$t("common.title"),value:"title"},null,8,["label"]),t(ae,{label:a.$t("common.content"),value:"content"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","placeholder"])]),b.value.length==0?(P(),S(de,{key:0,description:a.$t("common.noData")},null,8,["description"])):(P(),S(ne,{key:1,size:b.value.length,total:r.total,page_size:r.page_size,current_page:r.current_page,"onUpdate:current_page":o[3]||(o[3]=n=>r.current_page=n),onLoad:N,loading:d.value},{default:l(()=>[(P(!0),he($e,null,ye(b.value,(n,O)=>(P(),S(oe,{key:O,shadow:"hover",title:n.title||"-",description:n.content,class:Ve(["paragraph-card cursor mb-16",E(n.id)?"selected":""]),showIcon:!1,onClick:Je=>X(n)},null,8,["title","description","class","onClick"]))),128))]),_:1},8,["size","total","page_size","current_page","loading"]))])]),_:1})]),_:1})]),_:1})),[[_e,d.value]])]),_:2},[q.value?{name:"footer",fn:l(()=>[g("div",Fe,[t(re,{onClick:o[4]||(o[4]=n=>k.value=!1)},{default:l(()=>[C(v(a.$t("common.cancel")),1)]),_:1}),t(re,{type:"primary",onClick:B},{default:l(()=>[C(v(a.$t("common.confirm")),1)]),_:1})])]),key:"0"}:void 0]),1032,["title","modelValue"])}}});const He={class:"p-8"},We={class:"active-button"},je={class:"mr-4"},Ge={class:"footer-content flex-between"},Qe=se({__name:"DetailProblemDrawer",props:{currentId:{},currentContent:{},next:{},pre:{},pre_disable:{type:Boolean},next_disable:{type:Boolean}},emits:["update:currentId","update:currentContent","refresh"],setup(ee,{expose:H,emit:I}){const w=ee,x=I,U=ie(),{params:{id:D}}=U,{problem:R}=ce(),k=u(),d=u(),m=u(!1),i=u(!1),b=u([]);function _(r){R.asyncDisassociationProblem(r.dataset_id,r.document_id,r.id,w.currentId,m).then(()=>{$()})}function h(){k.value.open([w.currentId])}function p(r){d.value.open(r)}function f(r){if(r){const B={content:r};Q.putProblems(D,w.currentId,B,m).then(()=>{x("update:currentContent",r),j(M("common.modifySuccess"))})}else Pe(M("views.problem.tip.errorMessage"))}function V(){b.value=[]}function $(){w.currentId&&i.value&&Q.getDetailProblems(D,w.currentId,m).then(r=>{b.value=r.data})}function z(){$()}return J(()=>w.currentId,()=>{b.value=[],$()}),J(i,r=>{r||(x("update:currentId",""),x("update:currentContent",""),x("refresh"))}),H({open:()=>{$(),i.value=!0}}),(r,B)=>{const X=s("ReadWrite"),K=s("el-form-item"),Y=s("AppIcon"),A=s("el-button"),N=s("el-tooltip"),T=s("el-scrollbar"),W=s("Document"),E=s("el-icon"),te=s("el-text"),a=s("CardBox"),o=s("el-form"),L=s("el-drawer"),Z=ge("loading");return P(),S(L,{modelValue:i.value,"onUpdate:modelValue":B[1]||(B[1]=e=>i.value=e),size:"60%",onClose:V},{header:l(()=>[g("h4",null,v(r.$t("views.problem.detailProblem")),1)]),footer:l(()=>[g("div",null,[t(A,{onClick:h},{default:l(()=>[C(v(r.$t("views.problem.relateParagraph.title")),1)]),_:1}),t(A,{onClick:r.pre,disabled:r.pre_disable||m.value},{default:l(()=>[C(v(r.$t("views.log.buttons.prev")),1)]),_:1},8,["onClick","disabled"]),t(A,{onClick:r.next,disabled:r.next_disable||m.value},{default:l(()=>[C(v(r.$t("views.log.buttons.next")),1)]),_:1},8,["onClick","disabled"])])]),default:l(()=>[g("div",null,[t(T,null,{default:l(()=>[g("div",He,[be((P(),S(o,{"label-position":"top",onSubmit:B[0]||(B[0]=G(()=>{},["prevent"]))},{default:l(()=>[t(K,{label:r.$t("views.problem.title")},{default:l(()=>[t(X,{onChange:f,data:r.currentContent,showEditIcon:!0,maxlength:256},null,8,["data"])]),_:1},8,["label"]),t(K,{label:r.$t("views.problem.relateParagraph.title")},{default:l(()=>[(P(!0),he($e,null,ye(b.value,(e,c)=>(P(),S(a,{key:c,title:e.title||"-",class:"paragraph-source-card cursor mb-8",showIcon:!1,onClick:G(y=>p(e),["stop"])},{description:l(()=>[t(T,{height:"80"},{default:l(()=>[C(v(e.content),1)]),_:2},1024)]),footer:l(()=>[g("div",Ge,[t(te,null,{default:l(()=>[t(E,null,{default:l(()=>[t(W)]),_:1}),C(" "+v(e==null?void 0:e.document_name),1)]),_:2},1024)])]),default:l(()=>[g("div",We,[g("span",je,[t(N,{effect:"dark",content:r.$t("views.problem.setting.cancelRelated"),placement:"top"},{default:l(()=>[t(A,{type:"primary",text:"",onClick:G(y=>_(e),["stop"])},{default:l(()=>[t(Y,{iconName:"app-quxiaoguanlian"})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])])]),_:2},1032,["title","onClick"]))),128))]),_:1},8,["label"])]),_:1})),[[Z,m.value]])])]),_:1}),t(ze,{ref_key:"ParagraphDialogRef",ref:d,title:r.$t("views.paragraph.editParagraph"),onRefresh:z},null,8,["title"]),t(we,{ref_key:"RelateProblemDialogRef",ref:k,onRefresh:z},null,512)])]),_:1},8,["modelValue"])}}}),Ke={class:"main-calc-height"},Oe={class:"p-24"},Xe={class:"flex-between"},Ye={key:1},Ze={class:"mr-4"},at=se({__name:"index",setup(ee){const H=ie(),{params:{id:I}}=H,{problem:w}=ce(),x=u(),U=u(),D=u(),R=u(!1),k=u(""),d=u(""),m=u(""),i=fe({current_page:1,page_size:10,total:0}),b=u(""),_=u([]),h=ve(()=>_.value.map((e,c)=>({[e.id]:c})).reduce((e,c)=>({...e,...c}),{})),p=u(),f=u([]);function V(e){const c=[];e?c.push(e.id):f.value.map(y=>{y&&c.push(y.id)}),x.value.open(c)}function $(){D.value.open()}const z=e=>{f.value=e};function q(e){R.value=!0;const c=[e];w.asyncPostProblem(I,c).then(y=>{o(),j(M("common.createSuccess"))}).catch(()=>{R.value=!1})}function r(){const e=[];f.value.map(c=>{c&&e.push(c.id)}),Q.delMulProblem(I,e,R).then(()=>{var c;j(M("views.document.delete.successMessage")),(c=p.value)==null||c.clearSelection(),o()})}function B(e){xe(`${M("views.problem.delete.confirmTitle")} ${e.content} ?`,`${M("views.problem.delete.confirmMessage1")} ${e.paragraph_count} ${M("views.problem.delete.confirmMessage2")}`,{confirmButtonText:M("common.delete"),confirmButtonClass:"danger"}).then(()=>{Q.delProblems(I,e.id,R).then(()=>{j(M("common.deleteSuccess")),o()})}).catch(()=>{})}function X(e,c){if(e){const y={content:e};Q.putProblems(I,c,y,R).then(()=>{o(),j(M("common.modifySuccess"))})}else Pe(M("views.problem.tip.errorMessage"))}function K(e){k.value=e.id}function Y(){k.value=""}const A=()=>{let e=h.value[d.value]+1;if(e>=_.value.length){if(e+(i.current_page-1)*i.page_size>=i.total-1)return;i.current_page=i.current_page+1,o().then(()=>{e=0,d.value=_.value[e].id,m.value=_.value[e].content})}else d.value=_.value[e].id,m.value=_.value[e].content},N=ve(()=>h.value[d.value]-1<0&&i.current_page<=1),T=ve(()=>{let e=h.value[d.value]+1;return e>=_.value.length&&e+(i.current_page-1)*i.page_size>=i.total-1}),W=()=>{let e=h.value[d.value]-1;if(e<0){if(i.current_page<=1)return;i.current_page=i.current_page-1,o().then(c=>{e=i.page_size-1,d.value=_.value[e].id,m.value=_.value[e].content})}else d.value=_.value[e].id,m.value=_.value[e].content};function E(e,c){c&&c.type==="selection"||e.paragraph_count&&(d.value=e.id,m.value=e.content,U.value.open())}const te=({row:e})=>d.value===(e==null?void 0:e.id)?"highlight":"";function a(){i.current_page=1,o()}function o(){return w.asyncGetProblem(I,i,b.value&&{content:b.value},R).then(e=>{_.value=e.data.records,i.total=e.data.total})}function L(){var e;o(),(e=p.value)==null||e.clearSelection()}function Z(){i.current_page=1,o()}return Se(()=>{o()}),Ie(()=>{}),(e,c)=>{const y=s("el-button"),le=s("el-input"),F=s("el-table-column"),ae=s("ReadWrite"),ue=s("el-link"),de=s("Connection"),oe=s("el-icon"),ne=s("el-tooltip"),pe=s("Delete"),re=s("app-table"),me=s("LayoutContainer"),_e=ge("loading");return P(),S(me,{header:e.$t("views.problem.title")},{default:l(()=>[g("div",Ke,[g("div",Oe,[g("div",Xe,[g("div",null,[t(y,{type:"primary",onClick:$},{default:l(()=>[C(v(e.$t("views.problem.createProblem")),1)]),_:1}),t(y,{onClick:c[0]||(c[0]=n=>V()),disabled:f.value.length===0},{default:l(()=>[C(v(e.$t("views.problem.relateParagraph.title")),1)]),_:1},8,["disabled"]),t(y,{onClick:r,disabled:f.value.length===0},{default:l(()=>[C(v(e.$t("views.problem.setting.batchDelete")),1)]),_:1},8,["disabled"])]),t(le,{modelValue:b.value,"onUpdate:modelValue":c[1]||(c[1]=n=>b.value=n),placeholder:e.$t("views.problem.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",onChange:o,clearable:""},null,8,["modelValue","placeholder"])]),be((P(),S(re,{ref_key:"multipleTableRef",ref:p,class:"mt-16",data:_.value,"pagination-config":i,"quick-create":"",quickCreateName:e.$t("views.problem.quickCreateName"),quickCreatePlaceholder:e.$t("views.problem.quickCreateProblem"),quickCreateMaxlength:256,onSizeChange:a,onChangePage:o,onCellMouseEnter:K,onCellMouseLeave:Y,onCreatQuick:q,onRowClick:E,onSelectionChange:z,"row-class-name":te,"row-key":n=>n.id},{default:l(()=>[t(F,{type:"selection",width:"55","reserve-selection":!0}),t(F,{prop:"content",label:e.$t("views.problem.title"),"min-width":"280"},{default:l(({row:n})=>[t(ae,{onChange:O=>X(O,n.id),data:n.content,showEditIcon:n.id===k.value,maxlength:256},null,8,["onChange","data","showEditIcon"])]),_:1},8,["label"]),t(F,{prop:"paragraph_count",label:e.$t("views.problem.table.paragraph_count"),align:"right","min-width":"100"},{default:l(({row:n})=>[n.paragraph_count?(P(),S(ue,{key:0,type:"primary",onClick:G(O=>E(n),["stop"])},{default:l(()=>[C(v(n.paragraph_count),1)]),_:2},1032,["onClick"])):(P(),he("span",Ye,v(n.paragraph_count),1))]),_:1},8,["label"]),t(F,{prop:"create_time",label:e.$t("common.createTime"),width:"170"},{default:l(({row:n})=>[C(v(Ce(ke)(n.create_time)),1)]),_:1},8,["label"]),t(F,{prop:"update_time",label:e.$t("views.problem.table.updateTime"),width:"170"},{default:l(({row:n})=>[C(v(Ce(ke)(n.update_time)),1)]),_:1},8,["label"]),t(F,{label:e.$t("common.operation"),align:"left",fixed:"right"},{default:l(({row:n})=>[g("div",null,[g("span",Ze,[t(ne,{effect:"dark",content:e.$t("views.problem.relateParagraph.title"),placement:"top"},{default:l(()=>[t(y,{type:"primary",text:"",onClick:G(O=>V(n),["stop"])},{default:l(()=>[t(oe,null,{default:l(()=>[t(de)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),g("span",null,[t(ne,{effect:"dark",content:e.$t("common.delete"),placement:"top"},{default:l(()=>[t(y,{type:"primary",text:"",onClick:G(O=>B(n),["stop"])},{default:l(()=>[t(oe,null,{default:l(()=>[t(pe)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])])])]),_:1},8,["label"])]),_:1},8,["data","pagination-config","quickCreateName","quickCreatePlaceholder","row-key"])),[[_e,R.value]])])]),t(qe,{ref_key:"CreateProblemDialogRef",ref:D,onRefresh:Z},null,512),t(Qe,{next:A,pre:W,ref_key:"DetailProblemRef",ref:U,currentId:d.value,"onUpdate:currentId":c[2]||(c[2]=n=>d.value=n),currentContent:m.value,"onUpdate:currentContent":c[3]||(c[3]=n=>m.value=n),pre_disable:N.value,next_disable:T.value,onRefresh:L},null,8,["currentId","currentContent","pre_disable","next_disable"]),t(we,{ref_key:"RelateProblemDialogRef",ref:x,onRefresh:L},null,512)]),_:1},8,["header"])}}});export{at as default};
