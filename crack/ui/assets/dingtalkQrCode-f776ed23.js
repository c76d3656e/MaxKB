import{cr as g,dm as u,cZ as _,e$ as m,cs as f,da as h,cy as k,cz as y,cC as n,cK as v,cD as C,cX as w}from"./index-a6cfd98b.js";const q="/ui/assets/logo_dingtalk-ba6ce262.svg",x={class:"flex-center mb-16"},R=g({__name:"dingtalkQrCode",props:{config:{}},setup(i){const o=i,c=u(),{user:r}=_(),{load:d}=m("https://g.alicdn.com/dingding/h5-dingtalk-login/0.21.0/ddlogin.js"),a=f(!1),l=async()=>{try{if(await d(!0),!a.value)return;console.log(o.config);const e={appKey:o.config.app_key,appSecret:o.config.app_secret,corp_id:o.config.corp_id},t=encodeURIComponent(window.location.origin);window.DTFrameLogin({id:"ding-talk-qr",width:280,height:280},{redirect_uri:t,client_id:e.appKey,scope:"openid",response_type:"code",state:"fit2cloud-ding-qr",prompt:"consent"},s=>{const p=s.authCode;r.dingCallback(p).then(()=>{c.push({name:"home"})})},s=>{w(s),console.log(s)})}catch(e){console.error(e)}};return h(()=>o.config,e=>{e.app_secret&&e.app_key&&e.corp_id&&(a.value=!0,l())},{immediate:!0}),(e,t)=>(k(),y(C,null,[n("div",x,[t[0]||(t[0]=n("img",{src:q,alt:"",width:"24px",class:"mr-4"},null,-1)),n("h2",null,v(e.$t("views.system.authentication.scanTheQRCode.dingtalkQrCode")),1)]),t[1]||(t[1]=n("div",{class:"ding-talk-qrName"},[n("div",{id:"ding-talk-qr"})],-1))],64))}});export{R as default};
