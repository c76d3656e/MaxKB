import{cr as We,cZ as je,dk as Ze,cq as w,cs as r,c_ as He,cu as Je,cv as s,cS as Qe,cy as d,cG as u,cB as o,cC as n,cK as p,cA as a,cL as c,cw as U,cz as S,cM as g,cF as Xe,cD as Ye,cE as xe,cI as V,dh as B,di as el,dj as ll,cx as se,dq as al,de as tl,cO as N,cR as z,cP as ol}from"./index-a6cfd98b.js";import{A as il,T as nl,_ as sl,a as pl}from"./TTSModeParamSettingDialog-60321dca.js";import{_ as dl}from"./EditAvatarDialog.vue_vue_type_script_setup_true_lang-7b42e64b.js";const rl={class:"flex-between w-full"},ul={class:"p-24 mb-16",style:{"padding-bottom":"0"}},ml={class:"title-decoration-1"},cl={class:"scrollbar-height-left"},_l={class:"flex-between"},vl={class:"flex-between"},fl={class:"flex align-center"},gl={class:"mr-4"},bl={key:0,class:"danger ml-4"},hl={class:"flex-between"},wl={class:"w-full"},yl={class:"flex-between"},Fl={class:"flex align-center",style:{width:"80%"}},$l=["title"],Sl={class:"flex align-center"},Vl={class:"mr-4"},kl={key:0,class:"danger ml-4"},Dl={class:"flex-between"},Ml={class:"mr-4"},Pl={key:0,class:"danger"},Tl={class:"flex"},ql={class:"flex-between"},Al={class:"mr-4"},Rl={key:0,class:"danger"},Cl={class:"flex"},El={class:"w-full"},Il={class:"flex-between w-full"},Ul={class:"title-decoration-1 mb-16"},Bl={class:"dialog-bg"},Nl={class:"flex align-center p-24"},zl=["src"],Ol={class:"scrollbar-height"},Ll=We({__name:"ApplicationSetting",setup(Kl){const{model:Gl,application:P}=je(),pe=Ze(),{params:{id:v}}=pe,O=w("views.application.applicationForm.form.prompt.defaultPrompt",{data:"{data}",question:"{question}"}),de=w("views.application.applicationForm.dialog.defaultPrompt1",{question:"{question}"})+"<data></data>"+w("views.application.applicationForm.dialog.defaultPrompt2"),T=r(),q=r(),L=r(),K=r(),G=r(),W=r(),m=r(!1),j=r(!1),l=r({name:"",desc:"",model_id:"",dialogue_number:1,prologue:w("views.application.applicationForm.form.defaultPrologue"),dataset_id_list:[],dataset_setting:{top_n:3,similarity:.6,max_paragraph_char_number:5e3,search_mode:"embedding",no_references_setting:{status:"ai_questioning",value:"{question}"}},model_setting:{prompt:O,system:w("views.application.applicationForm.form.roleSettings.placeholder"),no_references_prompt:"{question}"},model_params_setting:{},problem_optimization:!1,problem_optimization_prompt:de,stt_model_id:"",tts_model_id:"",stt_model_enable:!1,tts_model_enable:!1,tts_type:"BROWSER",type:"SIMPLE"}),re=He({name:[{required:!0,message:w("views.application.applicationForm.form.appName.placeholder"),trigger:"blur"}]}),Z=r(null),y=r([]),H=r(null),J=r(null),A=r(!1);function ue(e){l.value.prologue=e}function me(e){l.value.model_setting.prompt=e}function ce(e){l.value.model_setting.no_references_prompt=e}function _e(e){l.value.model_setting.system=e}const ve=async e=>{e&&await e.validate((t,b)=>{t&&P.asyncPutApplication(v,l.value,m).then(R=>{tl(w("common.saveSuccess"))})})},fe=e=>{var t;l.value.model_id=e,e?(t=T.value)==null||t.reset_default(e,v):Q({})},ge=()=>{var e;l.value.model_id&&((e=T.value)==null||e.open(l.value.model_id,v,l.value.model_params_setting))},be=()=>{var e;l.value.tts_model_id&&((e=q.value)==null||e.open(l.value.tts_model_id,v,l.value.tts_model_params_setting))},he=()=>{var e;(e=L.value)==null||e.open(l.value)};function we(e){l.value={...l.value,...e}}function Q(e){l.value.model_params_setting=e}function X(e){l.value.tts_model_params_setting=e}function ye(e){l.value.dataset_id_list&&l.value.dataset_id_list.splice(l.value.dataset_id_list.indexOf(e),1)}function Fe(e){l.value.dataset_id_list=e}function $e(){G.value.open(l.value.dataset_id_list)}function Y(){P.asyncGetApplicationDetail(v,m).then(e=>{l.value=e.data,l.value.model_id=e.data.model,l.value.stt_model_id=e.data.stt_model,l.value.tts_model_id=e.data.tts_model,l.value.tts_type=e.data.tts_type,l.value.model_setting.no_references_prompt=e.data.model_setting.no_references_prompt||"{question}"})}function x(){P.asyncGetApplicationDataset(v,j).then(e=>{y.value=e.data})}function ee(){m.value=!0,N.getApplicationModel(v).then(e=>{Z.value=z.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function Se(){m.value=!0,N.getApplicationSTTModel(v).then(e=>{H.value=z.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function Ve(){m.value=!0,N.getApplicationTTSModel(v).then(e=>{J.value=z.groupBy(e==null?void 0:e.data,"provider"),m.value=!1}).catch(()=>{m.value=!1})}function ke(){var e;l.value.tts_model_id?(e=q.value)==null||e.reset_default(l.value.tts_model_id,v):X({})}function De(){l.value.tts_model_enable||(l.value.tts_model_id="",l.value.tts_type="BROWSER")}function Me(){l.value.stt_model_enable||(l.value.stt_model_id="")}function Pe(){W.value.open(l.value)}function Te(){Y()}function qe(){x()}return Je(()=>{ee(),x(),Y(),Se(),Ve()}),(e,t)=>{const b=s("el-button"),R=s("el-input"),_=s("el-form-item"),C=s("ModelSelect"),k=s("MdEditorMagnify"),E=s("AppIcon"),le=s("el-tooltip"),Ae=s("el-input-number"),Re=s("Plus"),D=s("el-icon"),Ce=s("el-text"),F=s("AppAvatar"),Ee=s("Close"),Ie=s("el-card"),I=s("el-col"),ae=s("el-row"),te=s("el-checkbox"),oe=s("el-switch"),ie=s("el-radio"),Ue=s("el-radio-group"),Be=s("Operation"),Ne=s("el-form"),ze=s("el-scrollbar"),Oe=s("EditPen"),Le=s("AiChat"),Ke=s("LayoutContainer"),Ge=Qe("loading");return d(),u(Ke,{class:"create-application"},{header:o(()=>[n("div",rl,[n("h3",null,p(e.$t("common.setting")),1),a(b,{type:"primary",onClick:t[0]||(t[0]=i=>ve(K.value)),disabled:m.value},{default:o(()=>[c(p(e.$t("views.application.applicationForm.buttons.publish")),1)]),_:1},8,["disabled"])])]),default:o(()=>[U((d(),u(ae,null,{default:o(()=>[a(I,{span:10},{default:o(()=>[n("div",ul,[n("h4",ml,p(e.$t("views.application.applicationForm.title.info")),1)]),n("div",cl,[a(ze,null,{default:o(()=>[a(Ne,{"hide-required-asterisk":"",ref_key:"applicationFormRef",ref:K,model:l.value,rules:re,"label-position":"top","require-asterisk-position":"right",class:"p-24",style:{"padding-top":"0"}},{default:o(()=>[a(_,{prop:"name"},{label:o(()=>[n("div",_l,[n("span",null,[c(p(e.$t("views.application.applicationForm.form.appName.label"))+" ",1),t[21]||(t[21]=n("span",{class:"danger"},"*",-1))])])]),default:o(()=>[a(R,{modelValue:l.value.name,"onUpdate:modelValue":t[1]||(t[1]=i=>l.value.name=i),maxlength:"64",placeholder:e.$t("views.application.applicationForm.form.appName.placeholder"),"show-word-limit":"",onBlur:t[2]||(t[2]=i=>{var f;return l.value.name=(f=l.value.name)==null?void 0:f.trim()})},null,8,["modelValue","placeholder"])]),_:1}),a(_,{label:e.$t("views.application.applicationForm.form.appDescription.label")},{default:o(()=>[a(R,{modelValue:l.value.desc,"onUpdate:modelValue":t[3]||(t[3]=i=>l.value.desc=i),type:"textarea",placeholder:e.$t("views.application.applicationForm.form.appDescription.placeholder"),rows:3,maxlength:"256","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(_,{label:e.$t("views.application.applicationForm.form.aiModel.label")},{label:o(()=>[n("div",vl,[n("span",null,p(e.$t("views.application.applicationForm.form.aiModel.label")),1),a(b,{type:"primary",link:"",onClick:ge,disabled:!l.value.model_id},{default:o(()=>[c(p(e.$t("common.paramSetting")),1)]),_:1},8,["disabled"])])]),default:o(()=>[a(C,{modelValue:l.value.model_id,"onUpdate:modelValue":t[4]||(t[4]=i=>l.value.model_id=i),placeholder:e.$t("views.application.applicationForm.form.aiModel.placeholder"),options:Z.value,onChange:fe,onSubmitModel:ee,showFooter:""},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"]),a(_,{label:e.$t("views.application.applicationForm.form.roleSettings.label")},{default:o(()=>[a(k,{title:e.$t("views.application.applicationForm.form.roleSettings.label"),modelValue:l.value.model_setting.system,"onUpdate:modelValue":t[5]||(t[5]=i=>l.value.model_setting.system=i),style:{height:"120px"},onSubmitDialog:_e,placeholder:e.$t("views.application.applicationForm.form.roleSettings.placeholder")},null,8,["title","modelValue","placeholder"])]),_:1},8,["label"]),a(_,{prop:"model_setting.no_references_prompt",rules:{required:l.value.model_id,message:e.$t("views.application.applicationForm.form.prompt.requiredMessage"),trigger:"blur"}},{label:o(()=>[n("div",fl,[n("span",gl,p(e.$t("views.application.applicationForm.form.prompt.label")+e.$t("views.application.applicationForm.form.prompt.noReferences")),1),a(le,{effect:"dark",content:e.$t("views.application.applicationForm.form.prompt.noReferencesTooltip",{question:"{question}"}),placement:"right","popper-class":"max-w-350"},{default:o(()=>[a(E,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"]),l.value.model_id?(d(),S("span",bl,"*")):g("",!0)])]),default:o(()=>[a(k,{title:e.$t("views.application.applicationForm.form.prompt.label")+e.$t("views.application.applicationForm.form.prompt.noReferences"),modelValue:l.value.model_setting.no_references_prompt,"onUpdate:modelValue":t[6]||(t[6]=i=>l.value.model_setting.no_references_prompt=i),style:{height:"120px"},onSubmitDialog:ce,placeholder:"{question}"},null,8,["title","modelValue"])]),_:1},8,["rules"]),a(_,{label:e.$t("views.application.applicationForm.form.historyRecord.label"),onClick:t[8]||(t[8]=Xe(()=>{},["prevent"]))},{default:o(()=>[a(Ae,{modelValue:l.value.dialogue_number,"onUpdate:modelValue":t[7]||(t[7]=i=>l.value.dialogue_number=i),min:0,"value-on-clear":0,"controls-position":"right",class:"w-full",step:1,"step-strictly":!0},null,8,["modelValue"])]),_:1},8,["label"]),a(_,{label:"$t('views.application.applicationForm.form.relatedKnowledgeBase')"},{label:o(()=>[n("div",hl,[n("span",null,p(e.$t("views.application.applicationForm.form.relatedKnowledge.label")),1),n("div",null,[a(b,{type:"primary",link:"",onClick:he},{default:o(()=>[a(E,{iconName:"app-operation",class:"mr-4"}),c(" "+p(e.$t("common.paramSetting")),1)]),_:1}),a(b,{type:"primary",link:"",onClick:$e},{default:o(()=>[a(D,{class:"mr-4"},{default:o(()=>[a(Re)]),_:1}),c(" "+p(e.$t("common.add")),1)]),_:1})])])]),default:o(()=>{var i;return[n("div",wl,[((i=l.value.dataset_id_list)==null?void 0:i.length)===0?(d(),u(Ce,{key:0,type:"info"},{default:o(()=>[c(p(e.$t("views.application.applicationForm.form.relatedKnowledge.placeholder")),1)]),_:1})):(d(),u(ae,{key:1,gutter:12},{default:o(()=>[(d(!0),S(Ye,null,xe(l.value.dataset_id_list,(f,M)=>(d(),u(I,{xs:24,sm:24,md:24,lg:12,xl:12,class:"mb-8",key:M},{default:o(()=>[a(Ie,{class:"relate-dataset-card border-r-4",shadow:"never"},{default:o(()=>{var $,h,ne;return[n("div",yl,[n("div",Fl,[(($=V(B)(y.value,f,"id"))==null?void 0:$.type)==="1"?(d(),u(F,{key:0,class:"mr-8 avatar-purple",shape:"square",size:32},{default:o(()=>t[22]||(t[22]=[n("img",{src:el,style:{width:"58%"},alt:""},null,-1)])),_:1})):(d(),u(F,{key:1,class:"mr-8 avatar-blue",shape:"square",size:32},{default:o(()=>t[23]||(t[23]=[n("img",{src:ll,style:{width:"58%"},alt:""},null,-1)])),_:1})),n("span",{class:"ellipsis cursor",title:(h=V(B)(y.value,f,"id"))==null?void 0:h.name},p((ne=V(B)(y.value,f,"id"))==null?void 0:ne.name),9,$l)]),a(b,{text:"",onClick:Wl=>ye(f)},{default:o(()=>[a(D,null,{default:o(()=>[a(Ee)]),_:1})]),_:2},1032,["onClick"])])]}),_:2},1024)]),_:2},1024))),128))]),_:1}))])]}),_:1}),a(_,{label:e.$t("views.application.applicationForm.form.prompt.label"),prop:"model_setting.prompt",rules:{required:l.value.model_id,message:e.$t("views.application.applicationForm.form.prompt.requiredMessage"),trigger:"blur"}},{label:o(()=>[n("div",Sl,[n("span",Vl,p(e.$t("views.application.applicationForm.form.prompt.label"))+" "+p(e.$t("views.application.applicationForm.form.prompt.references")),1),a(le,{effect:"dark",content:e.$t("views.application.applicationForm.form.prompt.referencesTooltip",{data:"{data}",question:"{question}"}),"popper-class":"max-w-350",placement:"right"},{default:o(()=>[a(E,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"]),l.value.model_id?(d(),S("span",kl,"*")):g("",!0)])]),default:o(()=>[a(k,{title:e.$t("views.application.applicationForm.form.prompt.label")+e.$t("views.application.applicationForm.form.prompt.references"),modelValue:l.value.model_setting.prompt,"onUpdate:modelValue":t[9]||(t[9]=i=>l.value.model_setting.prompt=i),style:{height:"150px"},onSubmitDialog:me,placeholder:V(O)},null,8,["title","modelValue","placeholder"])]),_:1},8,["label","rules"]),a(_,{label:e.$t("views.application.applicationForm.form.prologue")},{default:o(()=>[a(k,{title:e.$t("views.application.applicationForm.form.prologue"),modelValue:l.value.prologue,"onUpdate:modelValue":t[10]||(t[10]=i=>l.value.prologue=i),style:{height:"150px"},onSubmitDialog:ue},null,8,["title","modelValue"])]),_:1},8,["label"]),a(_,{prop:"stt_model_id",rules:{required:l.value.stt_model_enable,message:e.$t("views.application.applicationForm.form.voiceInput.requiredMessage"),trigger:"change"}},{label:o(()=>[n("div",Dl,[n("span",Ml,[c(p(e.$t("views.application.applicationForm.form.voiceInput.label"))+" ",1),l.value.stt_model_enable?(d(),S("span",Pl,"*")):g("",!0)]),n("div",Tl,[l.value.stt_model_enable?(d(),u(te,{key:0,modelValue:l.value.stt_autosend,"onUpdate:modelValue":t[11]||(t[11]=i=>l.value.stt_autosend=i)},{default:o(()=>[c(p(e.$t("views.application.applicationForm.form.voiceInput.autoSend")),1)]),_:1},8,["modelValue"])):g("",!0),a(oe,{class:"ml-8",size:"small",modelValue:l.value.stt_model_enable,"onUpdate:modelValue":t[12]||(t[12]=i=>l.value.stt_model_enable=i),onChange:Me},null,8,["modelValue"])])])]),default:o(()=>[U(a(C,{modelValue:l.value.stt_model_id,"onUpdate:modelValue":t[13]||(t[13]=i=>l.value.stt_model_id=i),placeholder:e.$t("views.application.applicationForm.form.voiceInput.placeholder"),options:H.value},null,8,["modelValue","placeholder","options"]),[[se,l.value.stt_model_enable]])]),_:1},8,["rules"]),a(_,{prop:"tts_model_id",rules:{required:l.value.tts_type==="TTS"&&l.value.tts_model_enable,message:e.$t("views.application.applicationForm.form.voicePlay.requiredMessage"),trigger:"change"}},{label:o(()=>[n("div",ql,[n("span",Al,[c(p(e.$t("views.application.applicationForm.form.voicePlay.label"))+" ",1),l.value.tts_type==="TTS"&&l.value.tts_model_enable?(d(),S("span",Rl,"*")):g("",!0)]),n("div",Cl,[l.value.tts_model_enable?(d(),u(te,{key:0,modelValue:l.value.tts_autoplay,"onUpdate:modelValue":t[14]||(t[14]=i=>l.value.tts_autoplay=i)},{default:o(()=>[c(p(e.$t("views.application.applicationForm.form.voicePlay.autoPlay")),1)]),_:1},8,["modelValue"])):g("",!0),a(oe,{class:"ml-8",size:"small",modelValue:l.value.tts_model_enable,"onUpdate:modelValue":t[15]||(t[15]=i=>l.value.tts_model_enable=i),onChange:De},null,8,["modelValue"])])])]),default:o(()=>[n("div",El,[U(a(Ue,{modelValue:l.value.tts_type,"onUpdate:modelValue":t[16]||(t[16]=i=>l.value.tts_type=i),class:"mb-8"},{default:o(()=>[a(ie,{value:"BROWSER"},{default:o(()=>[c(p(e.$t("views.application.applicationForm.form.voicePlay.browser")),1)]),_:1}),a(ie,{value:"TTS"},{default:o(()=>[c(p(e.$t("views.application.applicationForm.form.voicePlay.tts")),1)]),_:1})]),_:1},8,["modelValue"]),[[se,l.value.tts_model_enable]])]),n("div",Il,[l.value.tts_type==="TTS"&&l.value.tts_model_enable?(d(),u(C,{key:0,modelValue:l.value.tts_model_id,"onUpdate:modelValue":t[17]||(t[17]=i=>l.value.tts_model_id=i),placeholder:e.$t("views.application.applicationForm.form.voicePlay.placeholder"),options:J.value,onChange:t[18]||(t[18]=i=>ke())},null,8,["modelValue","placeholder","options"])):g("",!0),l.value.tts_type==="TTS"?(d(),u(b,{key:1,onClick:be,disabled:!l.value.tts_model_id,class:"ml-8"},{default:o(()=>[a(D,null,{default:o(()=>[a(Be)]),_:1})]),_:1},8,["disabled"])):g("",!0)])]),_:1},8,["rules"])]),_:1},8,["model","rules"])]),_:1})])]),_:1}),a(I,{span:14,class:"p-24 border-l"},{default:o(()=>{var i,f,M,$;return[n("h4",Ul,p(e.$t("views.application.applicationForm.title.appTest")),1),n("div",Bl,[n("div",Nl,[n("div",{class:"edit-avatar mr-12",onMouseenter:t[19]||(t[19]=h=>A.value=!0),onMouseleave:t[20]||(t[20]=h=>A.value=!1)},[V(al)((i=l.value)==null?void 0:i.icon)?(d(),u(F,{key:0,shape:"square",size:32,style:{background:"none"}},{default:o(()=>{var h;return[n("img",{src:(h=l.value)==null?void 0:h.icon,alt:""},null,8,zl)]}),_:1})):(f=l.value)!=null&&f.name?(d(),u(F,{key:1,name:(M=l.value)==null?void 0:M.name,pinyinColor:"",shape:"square",size:32},null,8,["name"])):g("",!0),A.value?(d(),u(F,{key:2,shape:"square",class:"edit-mask",size:32,onClick:Pe},{default:o(()=>[a(D,null,{default:o(()=>[a(Oe)]),_:1})]),_:1})):g("",!0)],32),n("h4",null,p((($=l.value)==null?void 0:$.name)||e.$t("views.application.applicationForm.form.appName.label")),1)]),n("div",Ol,[a(Le,{applicationDetails:l.value,type:"debug-ai-chat"},null,8,["applicationDetails"])])])]}),_:1})]),_:1})),[[Ge,m.value]]),a(il,{ref_key:"AIModeParamSettingDialogRef",ref:T,onRefresh:Q},null,512),a(nl,{ref_key:"TTSModeParamSettingDialogRef",ref:q,onRefresh:X},null,512),a(sl,{ref_key:"ParamSettingDialogRef",ref:L,onRefresh:we},null,512),a(pl,{ref_key:"AddDatasetDialogRef",ref:G,onAddData:Fe,data:y.value,onRefresh:qe,loading:j.value},null,8,["data","loading"]),a(dl,{ref_key:"EditAvatarDialogRef",ref:W,onRefresh:Te},null,512)]),_:1})}}});const Jl=ol(Ll,[["__scopeId","data-v-df7f9b6e"]]);export{Jl as default};
