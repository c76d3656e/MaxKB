var dt=Object.defineProperty;var rt=(O,D,N)=>D in O?dt(O,D,{enumerable:!0,configurable:!0,writable:!0,value:N}):O[D]=N;var Te=(O,D,N)=>(rt(O,typeof D!="symbol"?D+"":D,N),N);import{cr as ce,dk as Ce,cs as w,c_ as mt,cq as v,da as Ge,cv as u,cy as p,cG as h,cB as e,cC as b,cA as t,cF as Z,cL as o,cK as a,cM as Q,cz as ae,cD as he,cE as ye,cI as i,ea as j,de as J,cZ as Ue,cS as Be,cU as X,cw as Le,dj as pt,di as vt,ct as pe,cR as Ie,cT as _t,dm as ft,ed as gt,ee as ht,cu as yt,dp as kt,dV as Et,dl as Ve,cY as fe,cX as bt,cP as $t}from"./index-a6cfd98b.js";import{S as Ct}from"./SyncWebDialog-5de1c71b.js";import{_ as Dt}from"./index.vue_vue_type_style_index_0_scope_true_lang-e4ef588b.js";var ge=(O=>(O.optimization="views.document.hitHandlingMethod.optimization",O.directly_return="views.document.hitHandlingMethod.directly_return",O))(ge||{});const St={class:"flex align-center"},wt={class:"mr-4"},Rt={class:"lighter w-full",style:{"margin-top":"-20px"}},Mt={class:"dialog-footer"},Nt=ce({__name:"ImportDocumentDialog",props:{title:String},emits:["refresh"],setup(O,{expose:D,emit:N}){const R=Ce(),{params:{id:y}}=R,P=N,k=w(),f=w(!1),_=w(!1),s=w({source_url:"",selector:"",hit_handling_method:"optimization",directly_return_similarity:.9}),M=w(""),V=w(""),S=w([]),g=mt({source_url:[{required:!0,message:v("views.document.form.source_url.requiredMessage"),trigger:"blur"}],directly_return_similarity:[{required:!0,message:v("views.document.form.similarity.requiredMessage"),trigger:"blur"}]}),$=w(!1);Ge($,m=>{m||(s.value={source_url:"",selector:"",hit_handling_method:"optimization",directly_return_similarity:.9},_.value=!1,V.value="",M.value="",S.value=[])});const C=(m,E)=>{m?(V.value=m.type,M.value=m.id,s.value={hit_handling_method:m.hit_handling_method,directly_return_similarity:m.directly_return_similarity,...m.meta},_.value=!1):E?S.value=E:(V.value="1",_.value=!0),$.value=!0},A=async m=>{m&&await m.validate(E=>{if(E){if(_.value){const L={source_url_list:s.value.source_url.split(`
`),selector:s.value.selector};j.postWebDocument(y,L,f).then(()=>{J(v("views.document.tip.importMessage")),P("refresh"),$.value=!1})}else if(M.value){const L={hit_handling_method:s.value.hit_handling_method,directly_return_similarity:s.value.directly_return_similarity,meta:{source_url:s.value.source_url,selector:s.value.selector}};j.putDocument(y,M.value,L,f).then(()=>{J(v("common.settingSuccess")),P("refresh"),$.value=!1})}else if(S.value.length>0){const L={hit_handling_method:s.value.hit_handling_method,directly_return_similarity:s.value.directly_return_similarity,id_list:S.value};j.batchEditHitHandling(y,L,f).then(()=>{J(v("common.settingSuccess")),P("refresh"),$.value=!1})}}})};return D({open:C}),(m,E)=>{const L=u("el-input"),F=u("el-form-item"),W=u("AppIcon"),U=u("el-tooltip"),te=u("el-radio"),oe=u("el-radio-group"),se=u("el-input-number"),ie=u("el-form"),ne=u("el-button"),de=u("el-dialog");return p(),h(de,{title:O.title,modelValue:$.value,"onUpdate:modelValue":E[7]||(E[7]=z=>$.value=z),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0},{footer:e(()=>[b("span",Mt,[t(ne,{onClick:E[5]||(E[5]=Z(z=>$.value=!1,["prevent"]))},{default:e(()=>[o(a(m.$t("common.cancel")),1)]),_:1}),t(ne,{type:"primary",onClick:E[6]||(E[6]=z=>A(k.value)),loading:f.value},{default:e(()=>[o(a(m.$t("common.confirm")),1)]),_:1},8,["loading"])])]),default:e(()=>[t(ie,{"label-position":"top",ref_key:"webFormRef",ref:k,rules:g,model:s.value,"require-asterisk-position":"right"},{default:e(()=>[_.value?(p(),h(F,{key:0,label:m.$t("views.document.form.source_url.label"),prop:"source_url"},{default:e(()=>[t(L,{modelValue:s.value.source_url,"onUpdate:modelValue":E[0]||(E[0]=z=>s.value.source_url=z),placeholder:m.$t("views.document.form.source_url.placeholder"),rows:10,type:"textarea"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):!_.value&&V.value==="1"?(p(),h(F,{key:1,label:m.$t("views.document.form.source_url.label"),prop:"source_url"},{default:e(()=>[t(L,{modelValue:s.value.source_url,"onUpdate:modelValue":E[1]||(E[1]=z=>s.value.source_url=z),placeholder:m.$t("views.document.form.source_url.requiredMessage")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):Q("",!0),V.value==="1"?(p(),h(F,{key:2,label:m.$t("views.document.form.selector.label")},{default:e(()=>[t(L,{modelValue:s.value.selector,"onUpdate:modelValue":E[2]||(E[2]=z=>s.value.selector=z),placeholder:m.$t("views.document.form.selector.placeholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):Q("",!0),_.value?Q("",!0):(p(),h(F,{key:3},{label:e(()=>[b("div",St,[b("span",wt,a(m.$t("views.document.form.hit_handling_method.label")),1),t(U,{effect:"dark",content:m.$t("views.document.form.hit_handling_method.tooltip"),placement:"right"},{default:e(()=>[t(W,{iconName:"app-warning",class:"app-warning-icon"})]),_:1},8,["content"])])]),default:e(()=>[t(oe,{modelValue:s.value.hit_handling_method,"onUpdate:modelValue":E[3]||(E[3]=z=>s.value.hit_handling_method=z),class:"radio-block mt-4"},{default:e(()=>[(p(!0),ae(he,null,ye(i(ge),(z,B)=>(p(),h(te,{key:B,value:B},{default:e(()=>[o(a(m.$t(z)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})),!_.value&&s.value.hit_handling_method==="directly_return"?(p(),h(F,{key:4,prop:"directly_return_similarity"},{default:e(()=>[b("div",Rt,[b("span",null,a(m.$t("views.document.form.similarity.label")),1),t(se,{modelValue:s.value.directly_return_similarity,"onUpdate:modelValue":E[4]||(E[4]=z=>s.value.directly_return_similarity=z),min:0,max:1,precision:3,step:.1,"value-on-clear":0,"controls-position":"right",size:"small",class:"ml-4 mr-4"},null,8,["modelValue"]),b("span",null,a(m.$t("views.document.form.similarity.placeholder")),1)])]),_:1})):Q("",!0)]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])}}}),Tt={class:"my-header flex"},It=["id"],Vt={class:"content-height"},At={class:"p-16"},Gt={class:"flex align-center"},Ut={class:"ellipsis"},Bt={class:"dialog-footer"},Lt=ce({__name:"SelectDatasetDialog",emits:["refresh"],setup(O,{expose:D,emit:N}){const{dataset:R}=Ue(),y=Ce(),{params:{id:P}}=y,k=N,f=w(!1),_=w(!1),s=w(""),M=w([]),V=w([]);Ge(_,A=>{A||(s.value="",M.value=[],V.value=[])});const S=A=>{V.value=A,$(),_.value=!0},g=()=>{j.putMigrateMulDocument(P,s.value,V.value,f).then(A=>{k("refresh"),_.value=!1})};function $(){R.asyncGetAllDataset(f).then(A=>{var m;M.value=(m=A.data)==null?void 0:m.filter(E=>E.id!==P)})}const C=()=>{$()};return D({open:S}),(A,m)=>{const E=u("Refresh"),L=u("el-icon"),F=u("el-button"),W=u("AppAvatar"),U=u("el-radio"),te=u("el-card"),oe=u("el-col"),se=u("el-row"),ie=u("el-scrollbar"),ne=u("el-radio-group"),de=u("el-dialog"),z=Be("loading");return p(),h(de,{title:A.$t("views.log.selectDataset"),modelValue:_.value,"onUpdate:modelValue":m[2]||(m[2]=B=>_.value=B),width:"600",class:"select-dataset-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{header:e(({titleId:B,titleClass:K})=>[b("div",Tt,[b("h4",{id:B,class:X(K)},a(A.$t("views.log.selectDataset")),11,It),t(F,{link:"",class:"ml-16",onClick:C},{default:e(()=>[t(L,{class:"mr-4"},{default:e(()=>[t(E)]),_:1}),o(a(A.$t("common.refresh")),1)]),_:1})])]),footer:e(()=>[b("span",Bt,[t(F,{onClick:m[1]||(m[1]=Z(B=>_.value=!1,["prevent"]))},{default:e(()=>[o(a(A.$t("common.cancel")),1)]),_:1}),t(F,{type:"primary",onClick:g,disabled:!s.value||f.value},{default:e(()=>[o(a(A.$t("common.confirm")),1)]),_:1},8,["disabled"])])]),default:e(()=>[b("div",Vt,[t(ne,{modelValue:s.value,"onUpdate:modelValue":m[0]||(m[0]=B=>s.value=B),class:"card__radio"},{default:e(()=>[t(ie,{height:"500"},{default:e(()=>[b("div",At,[Le((p(),h(se,{gutter:12},{default:e(()=>[(p(!0),ae(he,null,ye(M.value,(B,K)=>(p(),h(oe,{span:12,key:K,class:"mb-16"},{default:e(()=>[t(te,{shadow:"never",class:X(["mb-8",B.id===s.value?"active":""])},{default:e(()=>[t(U,{value:B.id,size:"large"},{default:e(()=>[b("div",Gt,[(B==null?void 0:B.type)==="0"?(p(),h(W,{key:0,class:"mr-8 avatar-blue",shape:"square",size:32},{default:e(()=>m[3]||(m[3]=[b("img",{src:pt,style:{width:"58%"},alt:""},null,-1)])),_:1})):Q("",!0),(B==null?void 0:B.type)==="1"?(p(),h(W,{key:1,class:"mr-8 avatar-purple",shape:"square",size:32},{default:e(()=>m[4]||(m[4]=[b("img",{src:vt,style:{width:"58%"},alt:""},null,-1)])),_:1})):Q("",!0),b("span",Ut,a(B.name),1)])]),_:2},1032,["value"])]),_:2},1032,["class"])]),_:2},1024))),128))]),_:1})),[[z,f.value]])])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["title","modelValue"])}}});const I={EMBEDDING:1,GENERATE_PROBLEM:2,SYNC:3},r={PENDING:"0",STARTED:"1",SUCCESS:"2",FAILURE:"3",REVOKE:"4",REVOKED:"5",IGNORED:"n"};class Ae{constructor(D){Te(this,"task_status");D||(D=""),D=D.split("").reverse().join(""),this.task_status={};for(let N in I){const R=I[N],y=R-1;this.task_status[R]=D[y]?D[y]:"n"}}toString(){const D=[];for(let N in I){const R=I[N];D.push(this.task_status[R])}return D.reverse().join("")}}const zt=ce({__name:"StatusTable",props:{status:{},statusMeta:{},stateMap:{},taskTypeMap:{}},setup(O){const D=O,N=k=>{const f=new Ae(k.status);return Object.keys(I).map(_=>{const s=I[_];return{[s]:{[f.task_status[s]]:k.count}}}).reduce((_,s)=>({..._,...s}),{})},R=(k,f)=>k==null&&f?f:f==null&&k?k:typeof k=="object"&&typeof f=="object"?Ie.mergeWith(k,f,R):k+f,y=pe(()=>(D.statusMeta.aggs?D.statusMeta.aggs:[]).map(k=>N(k)).reduce((k,f)=>Ie.mergeWith(k,f,R),{})),P=pe(()=>Object.keys(I).map(k=>{const f=I[k],_=new Ae(D.status);return{type:f,state:_.task_status[f],aggs:y.value[f],time:D.statusMeta.state_time[f]}}).filter(k=>k.state!==r.IGNORED));return(k,f)=>{const _=u("SuccessFilled"),s=u("el-icon"),M=u("el-text"),V=u("CircleCloseFilled"),S=u("Loading");return p(!0),ae(he,null,ye(P.value,g=>(p(),ae("div",{key:g.type},[b("span",null,a(k.taskTypeMap[g.type])+"ï¼š",1),b("span",null,[g.state===i(r).SUCCESS||g.state===i(r).REVOKED?(p(),h(M,{key:0},{default:e(()=>[t(s,{class:"success"},{default:e(()=>[t(_)]),_:1}),o(" "+a(k.stateMap[g.state](g.type)),1)]),_:2},1024)):g.state===i(r).FAILURE?(p(),h(M,{key:1},{default:e(()=>[t(s,{class:"danger"},{default:e(()=>[t(V)]),_:1}),o(" "+a(k.stateMap[g.state](g.type)),1)]),_:2},1024)):g.state===i(r).STARTED?(p(),h(M,{key:2},{default:e(()=>[t(s,{class:"is-loading primary"},{default:e(()=>[t(S)]),_:1}),o(" "+a(k.stateMap[g.state](g.type)),1)]),_:2},1024)):g.state===i(r).PENDING?(p(),h(M,{key:3},{default:e(()=>[t(s,{class:"is-loading primary"},{default:e(()=>[t(S)]),_:1}),o(" "+a(k.stateMap[g.state](g.type)),1)]),_:2},1024)):g.state===i(r).REVOKE?(p(),h(M,{key:4},{default:e(()=>[t(s,{class:"is-loading primary"},{default:e(()=>[t(S)]),_:1}),o(" "+a(k.stateMap[g.state](g.type)),1)]),_:2},1024)):Q("",!0)]),b("span",{class:"ml-8 lighter",style:_t({color:[i(r).FAILURE,i(r).REVOKED].includes(g.state)?"#F54A45":""})},a(k.$t("views.document.fileStatus.finish"))+" "+a(Object.keys(g.aggs?g.aggs:{}).filter($=>$==i(r).SUCCESS).map($=>g.aggs[$]).reduce(($,C)=>$+C,0))+"/"+a(Object.values(g.aggs?g.aggs:{}).reduce(($,C)=>$+C,0)),5),t(M,{type:"info",class:"ml-12"},{default:e(()=>{var $;return[o(a(g.time?($=g.time[g.state==i(r).REVOKED?i(r).REVOKED:i(r).PENDING])==null?void 0:$.substring(0,19):void 0),1)]}),_:2},1024)]))),128)}}}),Ot=ce({__name:"Status",props:{status:{},statusMeta:{}},setup(O){const D=O,N=w(!1),R=[r.REVOKE,r.STARTED,r.PENDING,r.FAILURE,r.REVOKED,r.SUCCESS],y=pe(()=>{let _={key:0,value:""};for(const s in R){const M=R[s],V=D.status.indexOf(M);if(V>-1){_={key:D.status.length-V,value:M};break}}return _}),P={[I.EMBEDDING]:v("views.document.fileStatus.EMBEDDING"),[I.GENERATE_PROBLEM]:v("views.document.fileStatus.GENERATE"),[I.SYNC]:v("views.document.fileStatus.SYNC")},k={[I.EMBEDDING]:v("views.dataset.setting.vectorization"),[I.GENERATE_PROBLEM]:v("views.document.generateQuestion.title"),[I.SYNC]:v("views.dataset.setting.sync")},f={[r.PENDING]:_=>v("views.document.fileStatus.PENDING"),[r.STARTED]:_=>P[_],[r.REVOKE]:_=>v("views.document.fileStatus.REVOKE"),[r.REVOKED]:_=>v("views.document.fileStatus.SUCCESS"),[r.FAILURE]:_=>v("views.document.fileStatus.FAILURE"),[r.SUCCESS]:_=>v("views.document.fileStatus.SUCCESS")};return(_,s)=>{const M=u("SuccessFilled"),V=u("el-icon"),S=u("el-text"),g=u("CircleCloseFilled"),$=u("Loading"),C=u("el-popover");return p(),h(C,{visible:N.value,"onUpdate:visible":s[0]||(s[0]=A=>N.value=A),placement:"top",trigger:"hover","popper-style":{width:"auto"}},{default:e(()=>[N.value?(p(),h(zt,{key:0,status:_.status,statusMeta:_.statusMeta,taskTypeMap:k,stateMap:f},null,8,["status","statusMeta"])):Q("",!0)]),reference:e(()=>{var A,m,E,L,F,W;return[((A=y.value)==null?void 0:A.value)===i(r).SUCCESS||((m=y.value)==null?void 0:m.value)===i(r).REVOKED?(p(),h(S,{key:0},{default:e(()=>[t(V,{class:"success"},{default:e(()=>[t(M)]),_:1}),o(" "+a(f[y.value.value](y.value.key)),1)]),_:1})):((E=y.value)==null?void 0:E.value)===i(r).FAILURE?(p(),h(S,{key:1},{default:e(()=>[t(V,{class:"danger"},{default:e(()=>[t(g)]),_:1}),o(" "+a(f[y.value.value](y.value.key)),1)]),_:1})):((L=y.value)==null?void 0:L.value)===i(r).STARTED?(p(),h(S,{key:2},{default:e(()=>[t(V,{class:"is-loading primary"},{default:e(()=>[t($)]),_:1}),o(" "+a(f[y.value.value](y.value.key)),1)]),_:1})):((F=y.value)==null?void 0:F.value)===i(r).PENDING?(p(),h(S,{key:3},{default:e(()=>[t(V,{class:"is-loading primary"},{default:e(()=>[t($)]),_:1}),o(" "+a(f[y.value.value](y.value.key)),1)]),_:1})):((W=y.value)==null?void 0:W.value)===i(r).REVOKE?(p(),h(S,{key:4},{default:e(()=>[t(V,{class:"is-loading primary"},{default:e(()=>[t($)]),_:1}),o(" "+a(f[y.value.value](y.value.key)),1)]),_:1})):Q("",!0)]}),_:1},8,["visible"])}}}),Pt={class:"dialog-footer"},Ft=ce({__name:"EmbeddingContentDialog",setup(O,{expose:D}){const N=w(!1),R=w("error"),y={all:["0","1","2","3","4","5","n"],error:["0","1","3","4","5","n"]},P=w(),k=()=>{P.value&&P.value(y[R.value]),_()},f=s=>{P.value=s,N.value=!0},_=()=>{P.value=void 0,N.value=!1};return D({open:f,close:_}),(s,M)=>{const V=u("el-radio"),S=u("el-radio-group"),g=u("el-button"),$=u("el-dialog");return p(),h($,{modelValue:N.value,"onUpdate:modelValue":M[1]||(M[1]=C=>N.value=C),title:s.$t("views.document.form.selectVectorization.label"),"before-close":_},{footer:e(()=>[b("div",Pt,[t(g,{onClick:_},{default:e(()=>[o(a(s.$t("common.cancel")),1)]),_:1}),t(g,{type:"primary",onClick:k},{default:e(()=>[o(a(s.$t("common.submit")),1)]),_:1})])]),default:e(()=>[t(S,{modelValue:R.value,"onUpdate:modelValue":M[0]||(M[0]=C=>R.value=C),class:"radio-block"},{default:e(()=>[t(V,{value:"error",size:"large",class:"mb-16"},{default:e(()=>[o(a(s.$t("views.document.form.selectVectorization.error")),1)]),_:1}),t(V,{value:"all",size:"large"},{default:e(()=>[o(a(s.$t("views.document.form.selectVectorization.all")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"])}}}),jt={class:"main-calc-height"},Kt={class:"p-24"},qt={class:"flex-between"},Ht={key:0},Qt={class:"mr-4"},Wt={class:"mr-4"},Yt={key:1},Zt={class:"mr-4"},Xt={class:"mr-4"},Jt={key:0,class:"mul-operation w-full flex"},le="documents",xt=ce({__name:"index",setup(O){const D=ft(),N=Ce(),{params:{id:R}}=N,{common:y,dataset:P,document:k}=Ue(),f=(l,n)=>{const d=l.split("").reverse();return n-1>d.length+1?"n":d[n-1]};gt(()=>{y.savePage(le,null),y.saveCondition(le,null)}),ht(l=>{l.name!=="Paragraph"?(y.savePage(le,null),y.saveCondition(le,null)):y.saveCondition(le,{filterText:$.value,filterMethod:C.value})});const _=pe(()=>y.paginationConfig[le]),s=pe(()=>y.search[le]),M=w(),V=w(),S=w(!1);let g;const $=w(""),C=w({}),A=w([]),m=w(null),E=w({}),L=w({current_page:1,page_size:10,total:0}),F=w(),W=w(),U=w([]),te=w(""),oe=w(),se=l=>{j.exportDocument(l.name,l.dataset_id,l.id,S).then(()=>{J(v("common.exportSuccess"))})},ie=l=>{j.exportDocumentZip(l.name,l.dataset_id,l.id,S).then(()=>{J(v("common.exportSuccess"))})};function ne(l){const n=[];U.value.map(q=>{q&&n.push(q.id)});const d={id_list:n,type:l};j.batchCancelTask(R,d,S).then(()=>{var q;J(v("views.document.tip.cancelSuccess")),(q=W.value)==null||q.clearSelection()})}function de(){var l;(l=W.value)==null||l.clearSelection()}function z(l){const n=[];l?n.push(l.id):U.value.map(d=>{d&&n.push(d.id)}),oe.value.open(n)}function B(l){C.value[l.attr]=l.command,l.attr=="status"&&(C.value.task_type=l.task_type),Y()}function K(l,n,d){return{attr:l,command:n,task_type:d}}const ve=(l,n)=>{j.cancelTask(l.dataset_id,l.id,{type:n}).then(()=>{J(v("views.document.tip.sendMessage"))})};function ze(){te.value=v("views.document.importDocument"),F.value.open()}function De(l){te.value=v("common.setting"),F.value.open(l)}const Oe=l=>{U.value=l};function Pe(){te.value=v("common.setting");const l=U.value.map(n=>n.id);F.value.open(null,l)}const Fe=()=>{g=setInterval(()=>{Y(!0)},6e3)},je=()=>{g&&clearInterval(g)};function Ke(l){var n;(n=l.meta)!=null&&n.source_url?fe(v("views.document.sync.confirmTitle"),v("views.document.sync.confirmMessage1"),{confirmButtonText:v("views.document.sync.label"),confirmButtonClass:"danger"}).then(()=>{j.putDocumentSync(l.dataset_id,l.id).then(()=>{Y()})}).catch(()=>{}):fe(v("common.tip"),v("views.document.sync.confirmMessage2"),{confirmButtonText:v("common.confirm"),type:"warning"}).then(()=>{}).catch(()=>{})}function Se(l){var d;const n=q=>j.putDocumentRefresh(l.dataset_id,l.id,q).then(()=>{Y()});(d=M.value)==null||d.open(n)}function qe(l,n){n&&n.type==="selection"||D.push({path:`/dataset/${R}/${l.id}`})}function He(l){S.value=!0;const n=[{name:l}];k.asyncPostDocument(R,n).then(()=>{Y(),J(v("common.createSuccess"))}).catch(()=>{S.value=!1})}function Qe(){const l=[];U.value.map(n=>{n&&l.push(n.id)}),j.delMulSyncDocument(R,l,S).then(()=>{J(v("views.document.sync.successMessage")),Y()})}function We(){fe(`${v("views.document.delete.confirmTitle1")} ${U.value.length} ${v("views.document.delete.confirmTitle2")}`,v("views.document.delete.confirmMessage"),{confirmButtonText:v("common.delete"),confirmButtonClass:"danger"}).then(()=>{const l=[];U.value.map(n=>{n&&l.push(n.id)}),j.delMulDocument(R,l,S).then(()=>{var n;J(v("views.document.delete.successMessage")),(n=W.value)==null||n.clearSelection(),Y()})}).catch(()=>{})}function Ye(){var d;const l=U.value.map(q=>q.id),n=q=>{j.batchRefresh(R,l,q,S).then(()=>{var H;J(v("views.document.tip.vectorizationSuccess")),(H=W.value)==null||H.clearSelection()})};(d=M.value)==null||d.open(n)}function we(l){fe(`${v("views.document.delete.confirmTitle3")} ${l.name} ?`,`${v("views.document.delete.confirmMessage1")} ${l.paragraph_count} ${v("views.document.delete.confirmMessage2")}`,{confirmButtonText:v("common.delete"),confirmButtonClass:"danger"}).then(()=>{j.delDocument(R,l.id,S).then(()=>{J(v("common.deleteSuccess")),Y()})}).catch(()=>{})}function Re(l,n,d){j.putDocument(R,l,n,S).then(q=>{const H=A.value.findIndex(be=>be.id===l);return A.value.splice(H,1,q.data),J(d),!0}).catch(()=>!1)}function Ze(l){const n={is_active:!l.is_active},d=l.is_active?v("common.status.disableSuccess"):v("common.status.enableSuccess");m.value&&Re(l.id,n,d)}function Xe(l,n){l?Re(n,{name:l},v("common.modifySuccess")):bt(v("views.document.tip.nameMessage"))}function Je(l){m.value=l.id}function xe(){m.value=null}function et(){L.value.current_page=1,Y()}function Y(l){const n={...$.value&&{name:$.value},...C.value};j.getDocument(R,L.value,n,l?void 0:S).then(d=>{A.value=d.data.records,L.value.total=d.data.total})}function tt(){P.asyncGetDatasetDetail(R,S).then(l=>{E.value=l.data})}function lt(){var l;(l=W.value)==null||l.clearSelection(),Y()}function ke(){L.value.current_page=1,Y()}const Me=w();function Ee(l){const n=[];l?n.push(l.id):U.value.map(d=>{d&&n.push(d.id)}),Me.value.open(n,"document")}return yt(()=>{tt(),_.value&&(L.value=_.value),s.value&&($.value=s.value.filterText,C.value=s.value.filterMethod),Y(),Fe()}),kt(()=>{je()}),(l,n)=>{const d=u("el-button"),q=u("el-input"),H=u("el-table-column"),be=u("ReadWrite"),$e=u("Filter"),x=u("el-icon"),G=u("el-dropdown-item"),re=u("el-dropdown-menu"),me=u("el-dropdown"),at=u("el-switch"),ee=u("AppIcon"),ue=u("el-tooltip"),nt=u("Setting"),Ne=u("MoreFilled"),_e=u("Connection"),ot=u("Refresh"),st=u("app-table"),it=u("el-text"),ut=u("LayoutContainer"),ct=Be("loading");return p(),h(ut,{header:l.$t("common.fileUpload.document"),class:"document-main"},{default:e(()=>[b("div",jt,[b("div",Kt,[b("div",qt,[b("div",null,[E.value.type==="0"?(p(),h(d,{key:0,type:"primary",onClick:n[0]||(n[0]=c=>i(D).push({path:"/dataset/upload",query:{id:i(R)}}))},{default:e(()=>[o(a(l.$t("views.document.uploadDocument")),1)]),_:1})):Q("",!0),E.value.type==="1"?(p(),h(d,{key:1,type:"primary",onClick:ze},{default:e(()=>[o(a(l.$t("views.document.importDocument")),1)]),_:1})):Q("",!0),E.value.type==="1"?(p(),h(d,{key:2,onClick:Qe,disabled:U.value.length===0},{default:e(()=>[o(a(l.$t("views.document.syncDocument")),1)]),_:1},8,["disabled"])):Q("",!0),t(d,{onClick:n[1]||(n[1]=c=>z()),disabled:U.value.length===0},{default:e(()=>[o(a(l.$t("views.document.setting.migration")),1)]),_:1},8,["disabled"]),t(d,{onClick:Ye,disabled:U.value.length===0},{default:e(()=>[o(a(l.$t("views.dataset.setting.vectorization")),1)]),_:1},8,["disabled"]),t(d,{onClick:n[2]||(n[2]=c=>Ee()),disabled:U.value.length===0},{default:e(()=>[o(a(l.$t("views.document.generateQuestion.title")),1)]),_:1},8,["disabled"]),t(d,{onClick:Pe,disabled:U.value.length===0},{default:e(()=>[o(a(l.$t("common.setting")),1)]),_:1},8,["disabled"]),t(d,{onClick:We,disabled:U.value.length===0},{default:e(()=>[o(a(l.$t("common.delete")),1)]),_:1},8,["disabled"])]),t(q,{modelValue:$.value,"onUpdate:modelValue":n[3]||(n[3]=c=>$.value=c),placeholder:l.$t("views.document.searchBar.placeholder"),"prefix-icon":"Search",class:"w-240",onChange:Y,clearable:""},null,8,["modelValue","placeholder"])]),Le((p(),h(st,{ref_key:"multipleTableRef",ref:W,class:"mt-16",data:A.value,"pagination-config":L.value,"quick-create":E.value.type==="0",onSizeChange:et,onChangePage:Y,onCellMouseEnter:Je,onCellMouseLeave:xe,onCreatQuick:He,onRowClick:qe,onSelectionChange:Oe,"row-key":c=>c.id,storeKey:le},{default:e(()=>[t(H,{type:"selection",width:"55","reserve-selection":!0}),t(H,{prop:"name",label:l.$t("views.document.table.name"),"min-width":"280"},{default:e(({row:c})=>[t(be,{onChange:T=>Xe(T,c.id),data:c.name,showEditIcon:c.id===m.value},null,8,["onChange","data","showEditIcon"])]),_:1},8,["label"]),t(H,{prop:"char_length",label:l.$t("views.document.table.char_length"),align:"right","min-width":"90"},{default:e(({row:c})=>[o(a(i(Et)(c.char_length)),1)]),_:1},8,["label"]),t(H,{prop:"paragraph_count",label:l.$t("views.document.table.paragraph"),align:"right","min-width":"90"},null,8,["label"]),t(H,{prop:"status",label:l.$t("views.document.fileStatus.label"),width:"130"},{header:e(()=>[b("div",null,[b("span",null,a(l.$t("views.document.fileStatus.label")),1),t(me,{trigger:"click",onCommand:B},{dropdown:e(()=>[t(re,{style:{width:"100px"}},{default:e(()=>[t(G,{class:X([C.value.status?"":"is-active","justify-center"]),command:K("status","")},{default:e(()=>[o(a(l.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),t(G,{class:X([C.value.status===i(r).SUCCESS?"is-active":"","justify-center"]),command:K("status",i(r).SUCCESS)},{default:e(()=>[o(a(l.$t("views.document.fileStatus.SUCCESS")),1)]),_:1},8,["class","command"]),t(G,{class:X([C.value.status===i(r).FAILURE?"is-active":"","justify-center"]),command:K("status",i(r).FAILURE)},{default:e(()=>[o(a(l.$t("views.document.fileStatus.FAILURE")),1)]),_:1},8,["class","command"]),t(G,{class:X([C.value.status===i(r).STARTED&&C.value.task_type==i(I).EMBEDDING?"is-active":"","justify-center"]),command:K("status",i(r).STARTED,i(I).EMBEDDING)},{default:e(()=>[o(a(l.$t("views.document.fileStatus.EMBEDDING")),1)]),_:1},8,["class","command"]),t(G,{class:X([C.value.status===i(r).PENDING?"is-active":"","justify-center"]),command:K("status",i(r).PENDING)},{default:e(()=>[o(a(l.$t("views.document.fileStatus.PENDING")),1)]),_:1},8,["class","command"]),t(G,{class:X([C.value.status===i(r).STARTED&&C.value.task_type===i(I).GENERATE_PROBLEM?"is-active":"","justify-center"]),command:K("status",i(r).STARTED,i(I).GENERATE_PROBLEM)},{default:e(()=>[o(a(l.$t("views.document.fileStatus.GENERATE")),1)]),_:1},8,["class","command"])]),_:1})]),default:e(()=>[t(d,{style:{"margin-top":"1px"},link:"",type:C.value.status?"primary":""},{default:e(()=>[t(x,null,{default:e(()=>[t($e)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[t(Ot,{status:c.status,"status-meta":c.status_meta},null,8,["status","status-meta"])]),_:1},8,["label"]),t(H,{width:"130"},{header:e(()=>[b("div",null,[b("span",null,a(l.$t("views.document.enableStatus.label")),1),t(me,{trigger:"click",onCommand:B},{dropdown:e(()=>[t(re,{style:{width:"100px"}},{default:e(()=>[t(G,{class:X([C.value.is_active===""?"is-active":"","justify-center"]),command:K("is_active","")},{default:e(()=>[o(a(l.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),t(G,{class:X([C.value.is_active===!0?"is-active":"","justify-center"]),command:K("is_active",!0)},{default:e(()=>[o(a(l.$t("views.document.enableStatus.enable")),1)]),_:1},8,["class","command"]),t(G,{class:X([C.value.is_active===!1?"is-active":"","justify-center"]),command:K("is_active",!1)},{default:e(()=>[o(a(l.$t("views.document.enableStatus.close")),1)]),_:1},8,["class","command"])]),_:1})]),default:e(()=>[t(d,{style:{"margin-top":"1px"},link:"",type:C.value.is_active?"primary":""},{default:e(()=>[t(x,null,{default:e(()=>[t($e)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[b("div",{onClick:n[4]||(n[4]=Z(()=>{},["stop"]))},[t(at,{loading:S.value,size:"small",modelValue:c.is_active,"onUpdate:modelValue":T=>c.is_active=T,"before-change":()=>Ze(c)},null,8,["loading","modelValue","onUpdate:modelValue","before-change"])])]),_:1}),t(H,{width:"170"},{header:e(()=>[b("div",null,[b("span",null,a(l.$t("views.document.form.hit_handling_method.label")),1),t(me,{trigger:"click",onCommand:B},{dropdown:e(()=>[t(re,{style:{width:"150px"}},{default:e(()=>[t(G,{class:X([C.value.hit_handling_method?"":"is-active","justify-center"]),command:K("hit_handling_method","")},{default:e(()=>[o(a(l.$t("views.document.table.all")),1)]),_:1},8,["class","command"]),(p(!0),ae(he,null,ye(i(ge),(c,T)=>(p(),h(G,{key:T,class:X([C.value.hit_handling_method===T?"is-active":"","justify-center"]),command:K("hit_handling_method",T)},{default:e(()=>[o(a(l.$t(c)),1)]),_:2},1032,["class","command"]))),128))]),_:1})]),default:e(()=>[t(d,{style:{"margin-top":"1px"},link:"",type:C.value.hit_handling_method?"primary":""},{default:e(()=>[t(x,null,{default:e(()=>[t($e)]),_:1})]),_:1},8,["type"])]),_:1})])]),default:e(({row:c})=>[o(a(l.$t(i(ge)[c.hit_handling_method])),1)]),_:1}),t(H,{prop:"create_time",label:l.$t("common.createTime"),width:"175"},{default:e(({row:c})=>[o(a(i(Ve)(c.create_time)),1)]),_:1},8,["label"]),t(H,{prop:"update_time",label:l.$t("views.document.table.updateTime"),width:"175"},{default:e(({row:c})=>[o(a(i(Ve)(c.update_time)),1)]),_:1},8,["label"]),t(H,{label:l.$t("common.operation"),align:"left",width:"110",fixed:"right"},{default:e(({row:c})=>[E.value.type==="0"?(p(),ae("div",Ht,[b("span",Qt,[[i(r).STARTED,i(r).PENDING].includes(f(c.status,i(I).EMBEDDING))?(p(),h(ue,{key:0,effect:"dark",content:l.$t("views.document.setting.cancelVectorization"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:Z(T=>ve(c,i(I).EMBEDDING),["stop"])},{default:e(()=>[t(ee,{iconName:"app-close",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"])):(p(),h(ue,{key:1,effect:"dark",content:l.$t("views.dataset.setting.vectorization"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:Z(T=>Se(c),["stop"])},{default:e(()=>[t(ee,{iconName:"app-document-refresh",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"]))]),b("span",Wt,[t(ue,{effect:"dark",content:l.$t("common.setting"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:Z(T=>De(c),["stop"])},{default:e(()=>[t(x,null,{default:e(()=>[t(nt)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),b("span",{onClick:n[5]||(n[5]=Z(()=>{},["stop"]))},[t(me,{trigger:"click"},{dropdown:e(()=>[t(re,null,{default:e(()=>[[i(r).STARTED,i(r).PENDING].includes(f(c.status,i(I).GENERATE_PROBLEM))?(p(),h(G,{key:0,onClick:T=>ve(c,i(I).GENERATE_PROBLEM)},{default:e(()=>[t(x,null,{default:e(()=>[t(_e)]),_:1}),o(" "+a(l.$t("views.document.setting.cancelGenerateQuestion")),1)]),_:2},1032,["onClick"])):(p(),h(G,{key:1,onClick:T=>Ee(c)},{default:e(()=>[t(x,null,{default:e(()=>[t(_e)]),_:1}),o(" "+a(l.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"])),t(G,{onClick:T=>z(c)},{default:e(()=>[t(ee,{iconName:"app-migrate"}),o(" "+a(l.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),t(G,{onClick:T=>se(c)},{default:e(()=>[t(ee,{iconName:"app-export"}),o(" "+a(l.$t("common.export"))+"Excel ",1)]),_:2},1032,["onClick"]),t(G,{onClick:T=>ie(c)},{default:e(()=>[t(ee,{iconName:"app-export"}),o(" "+a(l.$t("common.export"))+"Zip ",1)]),_:2},1032,["onClick"]),t(G,{icon:"Delete",onClick:Z(T=>we(c),["stop"])},{default:e(()=>[o(a(l.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:e(()=>[t(d,{text:"",type:"primary"},{default:e(()=>[t(x,null,{default:e(()=>[t(Ne)]),_:1})]),_:1})]),_:2},1024)])])):Q("",!0),E.value.type==="1"?(p(),ae("div",Yt,[b("span",Zt,[t(ue,{effect:"dark",content:l.$t("views.dataset.setting.sync"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:Z(T=>Ke(c),["stop"])},{default:e(()=>[t(x,null,{default:e(()=>[t(ot)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])]),b("span",Xt,[[i(r).STARTED,i(r).PENDING].includes(f(c.status,i(I).EMBEDDING))?(p(),h(ue,{key:0,effect:"dark",content:l.$t("views.document.setting.cancelVectorization"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:Z(T=>ve(c,i(I).EMBEDDING),["stop"])},{default:e(()=>[t(ee,{iconName:"app-close",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"])):(p(),h(ue,{key:1,effect:"dark",content:l.$t("views.dataset.setting.vectorization"),placement:"top"},{default:e(()=>[t(d,{type:"primary",text:"",onClick:Z(T=>Se(c),["stop"])},{default:e(()=>[t(ee,{iconName:"app-document-refresh",style:{"font-size":"16px"}})]),_:2},1032,["onClick"])]),_:2},1032,["content"]))]),b("span",{onClick:n[6]||(n[6]=Z(()=>{},["stop"]))},[t(me,{trigger:"click"},{dropdown:e(()=>[t(re,null,{default:e(()=>[t(G,{icon:"Setting",onClick:T=>De(c)},{default:e(()=>[o(a(l.$t("common.setting")),1)]),_:2},1032,["onClick"]),[i(r).STARTED,i(r).PENDING].includes(f(c.status,i(I).GENERATE_PROBLEM))?(p(),h(G,{key:0,onClick:T=>ve(c,i(I).GENERATE_PROBLEM)},{default:e(()=>[t(x,null,{default:e(()=>[t(_e)]),_:1}),o(" "+a(l.$t("views.document.setting.cancelGenerateQuestion")),1)]),_:2},1032,["onClick"])):(p(),h(G,{key:1,onClick:T=>Ee(c)},{default:e(()=>[t(x,null,{default:e(()=>[t(_e)]),_:1}),o(" "+a(l.$t("views.document.generateQuestion.title")),1)]),_:2},1032,["onClick"])),t(G,{onClick:T=>z(c)},{default:e(()=>[t(ee,{iconName:"app-migrate"}),o(" "+a(l.$t("views.document.setting.migration")),1)]),_:2},1032,["onClick"]),t(G,{onClick:T=>se(c)},{default:e(()=>[t(ee,{iconName:"app-export"}),o(" "+a(l.$t("common.export"))+"Excel ",1)]),_:2},1032,["onClick"]),t(G,{onClick:T=>ie(c)},{default:e(()=>[t(ee,{iconName:"app-export"}),o(" "+a(l.$t("common.export"))+"Zip ",1)]),_:2},1032,["onClick"]),t(G,{icon:"Delete",onClick:Z(T=>we(c),["stop"])},{default:e(()=>[o(a(l.$t("common.delete")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:e(()=>[t(d,{text:"",type:"primary"},{default:e(()=>[t(x,null,{default:e(()=>[t(Ne)]),_:1})]),_:1})]),_:2},1024)])])):Q("",!0)]),_:1},8,["label"])]),_:1},8,["data","pagination-config","quick-create","row-key"])),[[ct,S.value]])]),t(Nt,{ref_key:"ImportDocumentDialogRef",ref:F,title:te.value,onRefresh:ke},null,8,["title"]),t(Ct,{ref_key:"SyncWebDialogRef",ref:V,onRefresh:ke},null,512),t(Lt,{ref_key:"SelectDatasetDialogRef",ref:oe,onRefresh:lt},null,512),t(Dt,{ref_key:"GenerateRelatedDialogRef",ref:Me,onRefresh:ke},null,512)]),U.value.length!==0?(p(),ae("div",Jt,[t(d,{disabled:U.value.length===0,onClick:n[7]||(n[7]=c=>ne(1))},{default:e(()=>[o(a(l.$t("views.document.setting.cancelVectorization")),1)]),_:1},8,["disabled"]),t(d,{disabled:U.value.length===0,onClick:n[8]||(n[8]=c=>ne(2))},{default:e(()=>[o(a(l.$t("views.document.setting.cancelGenerate")),1)]),_:1},8,["disabled"]),t(it,{type:"info",class:"secondary ml-24"},{default:e(()=>[o(a(l.$t("views.document.selected"))+" "+a(U.value.length)+" "+a(l.$t("views.document.items")),1)]),_:1}),t(d,{class:"ml-16",type:"primary",link:"",onClick:de},{default:e(()=>[o(a(l.$t("common.clear")),1)]),_:1})])):Q("",!0),t(Ft,{ref_key:"embeddingContentDialogRef",ref:M},null,512)]),_:1},8,["header"])}}});const nl=$t(xt,[["__scopeId","data-v-7058cd80"]]);export{nl as default};
