import{cr as j,cs as h,dk as G,c_ as R,cq as e,ct as z,cv as n,cy as r,cG as w,cB as l,cC as o,cK as i,cA as p,cL as u,cz as D,cD as W,cE as X,cM as m,cI as te,cW as ie,cO as E,de as H,cX as O,cu as ce,cP as le}from"./index-a6cfd98b.js";const se={class:"flex align-center",style:{"margin-left":"-8px"}},oe={class:"title-decoration-1 mb-16"},ne={key:0,class:"flex align-center mb-16"},pe={class:"lighter mr-8"},re={class:"title-decoration-1 mb-16"},de={class:"primary",href:"https://mp.weixin.qq.com/advanced/advanced?action=dev&t=advanced/dev",target:"_blank"},ue={class:"primary",href:"https://open-dev.dingtalk.com/fe/app?hash=%23%2Fcorp%2Fapp#/corp/app",target:"_blank"},_e={class:"primary",href:"https://work.weixin.qq.com/wework_admin/frame#apps",target:"_blank"},ge={class:"primary",href:"https://open.feishu.cn/app/",target:"_blank"},ve=j({__name:"AccessSettingDrawer",emits:["refresh"],setup(J,{expose:P,emit:V}){const k=h(),A=h(!1),g=h(!1),b=h(!1),t=h("wechat"),q=G(),L=V,{params:{id:_}}=q,c=R({wechat:{app_id:"",app_secret:"",token:"",encoding_aes_key:"",is_certification:!1,callback_url:""},dingtalk:{client_id:"",client_secret:"",callback_url:""},wecom:{app_id:"",agent_id:"",secret:"",token:"",encoding_aes_key:"",callback_url:""},feishu:{app_id:"",app_secret:"",verification_token:"",callback_url:""}}),y=R({wechat:{app_id:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.appSecretPlaceholder"),trigger:"blur"}],token:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.tokenPlaceholder"),trigger:"blur"}],encoding_aes_key:[{required:!0,message:e("views.application.applicationAccess.wechatSetting.aesKeyPlaceholder"),trigger:"blur"}]},dingtalk:{client_id:[{required:!0,message:e("views.application.applicationAccess.dingtalkSetting.clientIdPlaceholder"),trigger:"blur"}],client_secret:[{required:!0,message:e("views.application.applicationAccess.dingtalkSetting.clientSecretPlaceholder"),trigger:"blur"}]},wecom:{app_id:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.cropIdPlaceholder"),trigger:"blur"}],agent_id:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.agentIdPlaceholder"),trigger:"blur"}],secret:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.secretPlaceholder"),trigger:"blur"}],token:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.tokenPlaceholder"),trigger:"blur"}],encoding_aes_key:[{required:!0,message:e("views.application.applicationAccess.wecomSetting.encodingAesKeyPlaceholder"),trigger:"blur"}]},feishu:{app_id:[{required:!0,message:e("views.application.applicationAccess.larkSetting.appIdPlaceholder"),trigger:"blur"}],app_secret:[{required:!0,message:e("views.application.applicationAccess.larkSetting.appSecretPlaceholder"),trigger:"blur"}],verification_token:[{required:!1,message:e("views.application.applicationAccess.larkSetting.verificationTokenPlaceholder"),trigger:"blur"}]}}),I={wechat:{app_id:{label:e("views.application.applicationAccess.wechatSetting.appId"),placeholder:""},app_secret:{label:e("views.application.applicationAccess.wechatSetting.appSecret"),placeholder:""},token:{label:e("views.application.applicationAccess.wechatSetting.token"),placeholder:""},encoding_aes_key:{label:e("views.application.applicationAccess.wechatSetting.aesKey"),placeholder:""}},dingtalk:{client_id:{label:"Client ID",placeholder:""},client_secret:{label:"Client Secret",placeholder:""}},wecom:{app_id:{label:e("views.application.applicationAccess.wecomSetting.cropId"),placeholder:""},agent_id:{label:"Agent ID",placeholder:""},secret:{label:"Secret",placeholder:""},token:{label:"Token",placeholder:""},encoding_aes_key:{label:"EncodingAESKey",placeholder:""}},feishu:{app_id:{label:"App ID",placeholder:""},app_secret:{label:"App Secret",placeholder:""},verification_token:{label:"Verification Token",placeholder:""}}},C=new Set(["app_secret","client_secret","secret"]),F=z(()=>({wechat:e("views.application.applicationAccess.wechatSetting.title"),dingtalk:e("views.application.applicationAccess.dingtalkSetting.title"),wecom:e("views.application.applicationAccess.wecomSetting.title"),feishu:e("views.application.applicationAccess.larkSetting.title")})[t.value]),M=z(()=>({wechat:e("views.application.applicationAccess.info"),dingtalk:e("views.application.applicationAccess.info"),wecom:e("views.application.applicationAccess.info"),feishu:e("views.application.applicationAccess.info")})[t.value]),B=R(Object.keys(I[t.value]).reduce((a,s)=>(C.has(s)&&(a[s]=!1),a),{})),U=a=>C.has(a),d=()=>{A.value=!1},K=async()=>{var a;g.value||(a=k.value)==null||a.validate(async s=>{if(s)try{E.updatePlatformConfig(_,t.value,c[t.value],g).then(()=>{H(e("common.saveSuccess")),d(),L("refresh")})}catch{O(e("views.application.tip.saveErrorMessage"))}})};return P({open:async(a,s)=>{var S;A.value=!0,t.value=s,g.value=!0,b.value=!1,(S=k.value)==null||S.resetFields();try{const $=await E.getPlatformConfig(a,s);$.data&&(c[t.value]=$.data),b.value=!0}catch{O(e("views.application.tip.loadingErrorMessage"))}finally{g.value=!1,c[t.value].callback_url=`${window.location.origin}/api/${s}/${a}`}}}),(a,s)=>{const S=n("el-input"),$=n("el-form-item"),Q=n("el-switch"),Y=n("AppIcon"),N=n("el-button"),T=n("el-text"),Z=n("el-form"),ee=n("el-drawer");return r(),w(ee,{modelValue:A.value,"onUpdate:modelValue":s[3]||(s[3]=v=>A.value=v),size:"60%","append-to-body":!0},{header:l(()=>[o("div",se,[o("h4",null,i(F.value),1)])]),footer:l(()=>[o("div",null,[p(N,{onClick:d},{default:l(()=>[u(i(a.$t("common.cancel")),1)]),_:1}),p(N,{type:"primary",onClick:K,disabled:g.value},{default:l(()=>[u(i(a.$t("common.save")),1)]),_:1},8,["disabled"])])]),default:l(()=>[b.value?(r(),w(Z,{key:0,ref_key:"formRef",ref:k,model:c[t.value],"label-width":"120px",rules:y[t.value],"label-position":"top","require-asterisk-position":"right"},{default:l(()=>[o("h4",oe,i(M.value),1),(r(!0),D(W,null,X(I[t.value],(v,f)=>(r(),w($,{key:f,label:v.label,prop:f},{default:l(()=>[p(S,{modelValue:c[t.value][f],"onUpdate:modelValue":ae=>c[t.value][f]=ae,type:U(f)?B[f]?"text":"password":"text",placeholder:v.placeholder,"show-password":U(f)},null,8,["modelValue","onUpdate:modelValue","type","placeholder","show-password"])]),_:2},1032,["label","prop"]))),128)),t.value==="wechat"?(r(),D("div",ne,[o("span",pe,i(a.$t("views.application.applicationAccess.wecomSetting.authenticationSuccessful")),1),t.value==="wechat"?(r(),w(Q,{key:0,modelValue:c[t.value].is_certification,"onUpdate:modelValue":s[0]||(s[0]=v=>c[t.value].is_certification=v)},null,8,["modelValue"])):m("",!0)])):m("",!0),o("h4",re,i(a.$t("views.application.applicationAccess.callback")),1),p($,{label:"URL",prop:"callback_url"},{default:l(()=>[p(S,{modelValue:c[t.value].callback_url,"onUpdate:modelValue":s[2]||(s[2]=v=>c[t.value].callback_url=v),placeholder:a.$t("views.application.applicationAccess.callbackTip"),readonly:""},{append:l(()=>[p(N,{onClick:s[1]||(s[1]=v=>te(ie)(c[t.value].callback_url))},{default:l(()=>[p(Y,{iconName:"app-copy"})]),_:1})]),_:1},8,["modelValue","placeholder"]),t.value==="wechat"?(r(),w(T,{key:0,type:"info"},{default:l(()=>[u(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",de,i(a.$t("views.application.applicationAccess.wechatPlatform")),1),u(i(a.$t("views.application.applicationAccess.wechatSetting.urlInfo")),1)]),_:1})):m("",!0),t.value==="dingtalk"?(r(),w(T,{key:1,type:"info"},{default:l(()=>[u(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",ue,i(a.$t("views.application.applicationAccess.dingtalkPlatform")),1),u(i(a.$t("views.application.applicationAccess.dingtalkSetting.urlInfo")),1)]),_:1})):m("",!0),t.value==="wecom"?(r(),w(T,{key:2,type:"info"},{default:l(()=>[u(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",_e,i(a.$t("views.application.applicationAccess.wecomPlatform")),1),u(i(a.$t("views.application.applicationAccess.wecomSetting.urlInfo")),1)]),_:1})):m("",!0),t.value==="feishu"?(r(),w(T,{key:3,type:"info"},{default:l(()=>[u(i(a.$t("views.application.applicationAccess.copyUrl"))+" ",1),o("a",ge,i(a.$t("views.application.applicationAccess.larkPlatform")),1),u(i(a.$t("views.application.applicationAccess.larkSetting.urlInfo")),1)]),_:1})):m("",!0)]),_:1})]),_:1},8,["model","rules"])):m("",!0)]),_:1},8,["modelValue"])}}}),we={class:"p-16-24"},fe={class:"mb-16"},me={class:"flex-between"},he={class:"flex align-center ml-8 mr-8"},ke=["src"],Ae={class:"ml-12"},be={class:"mb-4"},ye=j({__name:"ApplicationAccess",setup(J){const P=R([{key:"wecom",logoSrc:new URL("/ui/assets/logo_wechat-work-74043648.svg",self.location).href,name:e("views.application.applicationAccess.wecom"),description:e("views.application.applicationAccess.wecomTip"),isActive:!1,exists:!1},{key:"dingtalk",logoSrc:new URL("/ui/assets/logo_dingtalk-ba6ce262.svg",self.location).href,name:e("views.application.applicationAccess.dingtalk"),description:e("views.application.applicationAccess.dingtalkTip"),isActive:!1,exists:!1},{key:"wechat",logoSrc:new URL("/ui/assets/logo_wechat-8623e982.svg",self.location).href,name:e("views.application.applicationAccess.wechat"),description:e("views.application.applicationAccess.wechatTip"),isActive:!1,exists:!1},{key:"feishu",logoSrc:new URL("/ui/assets/logo_lark-040c9608.svg",self.location).href,name:e("views.application.applicationAccess.lark"),description:e("views.application.applicationAccess.larkTip"),isActive:!1,exists:!1}]),V=h(),k=h(!1),A=G(),{params:{id:g}}=A;function b(_){V.value.open(g,_)}function t(){q()}function q(){k.value=!0,E.getPlatformStatus(g).then(_=>{P.forEach(c=>{c.isActive=_.data[c.key][1],c.exists=_.data[c.key][0]}),k.value=!1})}function L(_,c){const y={type:_,status:c};E.updatePlatformStatus(g,y).then(()=>{H(e("common.saveSuccess"))})}return ce(()=>{q()}),(_,c)=>{const y=n("el-text"),I=n("el-switch"),C=n("el-divider"),F=n("el-button"),M=n("el-card"),B=n("el-col"),U=n("el-row");return r(),D("div",we,[o("h4",fe,i(_.$t("views.application.applicationAccess.title")),1),p(U,{gutter:16},{default:l(()=>[(r(!0),D(W,null,X(P,(d,K)=>(r(),w(B,{xs:24,sm:24,md:12,lg:12,xl:12,class:"mb-16",key:K},{default:l(()=>[p(M,{shadow:"hover",class:"border-none cursor",style:{"--el-card-padding":"24px"}},{default:l(()=>[o("div",me,[o("div",he,[o("img",{src:d.logoSrc,alt:"",class:"icon"},null,8,ke),o("div",Ae,[o("h5",be,i(d.name),1),p(y,{type:"info",style:{"font-size":"12px"}},{default:l(()=>[u(i(d.description),1)]),_:2},1024)])]),o("div",null,[p(I,{size:"small",modelValue:d.isActive,"onUpdate:modelValue":x=>d.isActive=x,onChange:x=>L(d.key,d.isActive),disabled:!d.exists},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"]),p(C,{direction:"vertical"}),p(F,{class:"mr-4",onClick:x=>b(d.key)},{default:l(()=>[u(i(_.$t("views.application.applicationAccess.setting")),1)]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),p(ve,{ref_key:"AccessSettingDrawerRef",ref:V,onRefresh:t},null,512)])}}});const $e=le(ye,[["__scopeId","data-v-009e60bc"]]);export{$e as default};
