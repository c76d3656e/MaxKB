import{cr as Q,cs as V,c_ as F,cq as i,cu as O,cv as d,cS as z,cy as g,cz as y,cA as t,cB as n,cw as B,cL as $,cK as b,cC as C,de as N,cG as R,cI as oe,ez as se,cD as W,cE as G,cX as Y,cP as x,cM as I,cW as de,cZ as re,dm as ce,cH as ue}from"./index-a6cfd98b.js";import{a as D,p as J}from"./platform-source-63988aef.js";const pe={class:"authentication-setting__main main-calc-height"},_e={class:"form-container p-24"},me={class:"text-right"},ge=Q({__name:"LDAP",setup(M){const a=V({id:"",auth_type:"LDAP",config_data:{ldap_server:"",base_dn:"",password:"",ou:"",ldap_filter:"",ldap_mapping:""},is_active:!0}),h=V(),m=V(!1),f=F({"config_data.ldap_server":[{required:!0,message:i("views.system.authentication.ldap.serverPlaceholder"),trigger:"blur"}],"config_data.base_dn":[{required:!0,message:i("views.system.authentication.ldap.bindDNPlaceholder"),trigger:"blur"}],"config_data.password":[{required:!0,message:i("views.user.userForm.form.password.requiredMessage"),trigger:"blur"}],"config_data.ou":[{required:!0,message:i("views.system.authentication.ldap.ouPlaceholder"),trigger:"blur"}],"config_data.ldap_filter":[{required:!0,message:i("views.system.authentication.ldap.ldap_filterPlaceholder"),trigger:"blur"}],"config_data.ldap_mapping":[{required:!0,message:i("views.system.authentication.ldap.ldap_mappingPlaceholder"),trigger:"blur"}]}),w=async(e,l)=>{e&&await e.validate((u,s)=>{u&&(l?D.postAuthSetting(a.value,m).then(k=>{N(i("views.system.testFailed"))}):D.putAuthSetting(a.value.auth_type,a.value,m).then(k=>{N(i("common.saveSuccess"))}))})};function r(){D.getAuthSetting(a.value.auth_type,m).then(e=>{e.data&&JSON.stringify(e.data)!=="{}"&&(a.value=e.data,e.data.config_data.ldap_mapping&&(a.value.config_data.ldap_mapping=JSON.stringify(JSON.parse(e.data.config_data.ldap_mapping))))})}return O(()=>{r()}),(e,l)=>{const u=d("el-input"),s=d("el-form-item"),k=d("el-checkbox"),E=d("el-form"),P=d("el-button"),c=d("el-scrollbar"),_=z("loading");return g(),y("div",pe,[t(c,null,{default:n(()=>[B((g(),y("div",_e,[t(E,{ref_key:"authFormRef",ref:h,rules:f,model:a.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[t(s,{label:e.$t("views.system.authentication.ldap.address"),prop:"config_data.ldap_server"},{default:n(()=>[t(u,{modelValue:a.value.config_data.ldap_server,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.config_data.ldap_server=o),placeholder:e.$t("views.system.authentication.ldap.serverPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.ldap.bindDN"),prop:"config_data.base_dn"},{default:n(()=>[t(u,{modelValue:a.value.config_data.base_dn,"onUpdate:modelValue":l[1]||(l[1]=o=>a.value.config_data.base_dn=o),placeholder:e.$t("views.system.authentication.ldap.bindDNPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.password"),prop:"config_data.password"},{default:n(()=>[t(u,{modelValue:a.value.config_data.password,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.config_data.password=o),placeholder:e.$t("views.user.userForm.form.password.placeholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.ldap.ou"),prop:"config_data.ou"},{default:n(()=>[t(u,{modelValue:a.value.config_data.ou,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.config_data.ou=o),placeholder:e.$t("views.system.authentication.ldap.ouPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.ldap.ldap_filter"),prop:"config_data.ldap_filter"},{default:n(()=>[t(u,{modelValue:a.value.config_data.ldap_filter,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.config_data.ldap_filter=o),placeholder:e.$t("views.system.authentication.ldap.ldap_filterPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.ldap.ldap_mapping"),prop:"config_data.ldap_mapping"},{default:n(()=>[t(u,{modelValue:a.value.config_data.ldap_mapping,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.config_data.ldap_mapping=o),placeholder:'{"name":"name","email":"mail","username":"cn"}'},null,8,["modelValue"])]),_:1},8,["label"]),t(s,null,{default:n(()=>[t(k,{modelValue:a.value.is_active,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.is_active=o)},{default:n(()=>[$(b(e.$t("views.system.authentication.ldap.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",me,[t(P,{onClick:l[7]||(l[7]=o=>w(h.value,"test")),disabled:m.value},{default:n(()=>[$(b(e.$t("views.system.test")),1)]),_:1},8,["disabled"]),t(P,{onClick:l[8]||(l[8]=o=>w(h.value)),type:"primary",disabled:m.value},{default:n(()=>[$(b(e.$t("common.save")),1)]),_:1},8,["disabled"])])])),[[_,m.value]])]),_:1})])}}}),fe={class:"authentication-setting__main main-calc-height"},he={class:"form-container p-24"},ve={class:"text-right"},be=Q({__name:"CAS",setup(M){const a=V({id:"",auth_type:"CAS",config_data:{ldpUri:"",validateUrl:"",redirectUrl:""},is_active:!0}),h=V(),m=V(!1),f=F({"config_data.ldpUri":[{required:!0,message:i("views.system.authentication.cas.ldpUriPlaceholder"),trigger:"blur"}],"config_data.validateUrl":[{required:!0,message:i("views.system.authentication.cas.validateUrlPlaceholder"),trigger:"blur"}],"config_data.redirectUrl":[{required:!0,message:i("views.system.authentication.cas.redirectUrlPlaceholder"),trigger:"blur"}]}),w=async e=>{e&&await e.validate((l,u)=>{l&&D.putAuthSetting(a.value.auth_type,a.value,m).then(s=>{N(i("common.saveSuccess"))})})};function r(){D.getAuthSetting(a.value.auth_type,m).then(e=>{e.data&&JSON.stringify(e.data)!=="{}"&&(e.data.config_data.validateUrl||(e.data.config_data.validateUrl=e.data.config_data.ldpUri),a.value=e.data)})}return O(()=>{r()}),(e,l)=>{const u=d("el-input"),s=d("el-form-item"),k=d("el-checkbox"),E=d("el-form"),P=d("el-button"),c=d("el-scrollbar"),_=z("loading");return g(),y("div",fe,[t(c,null,{default:n(()=>[B((g(),y("div",he,[t(E,{ref_key:"authFormRef",ref:h,rules:f,model:a.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[t(s,{label:e.$t("views.system.authentication.cas.ldpUri"),prop:"config_data.ldpUri"},{default:n(()=>[t(u,{modelValue:a.value.config_data.ldpUri,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.config_data.ldpUri=o),placeholder:e.$t("views.system.authentication.cas.ldpUriPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.cas.validateUrl"),prop:"config_data.validateUrl"},{default:n(()=>[t(u,{modelValue:a.value.config_data.validateUrl,"onUpdate:modelValue":l[1]||(l[1]=o=>a.value.config_data.validateUrl=o),placeholder:e.$t("views.system.authentication.cas.validateUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.cas.redirectUrl"),prop:"config_data.redirectUrl"},{default:n(()=>[t(u,{modelValue:a.value.config_data.redirectUrl,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.config_data.redirectUrl=o),placeholder:e.$t("views.system.authentication.cas.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,null,{default:n(()=>[t(k,{modelValue:a.value.is_active,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.is_active=o)},{default:n(()=>[$(b(e.$t("views.system.authentication.cas.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",ve,[t(P,{onClick:l[4]||(l[4]=o=>w(h.value)),type:"primary",disabled:m.value},{default:n(()=>[$(b(e.$t("common.save")),1)]),_:1},8,["disabled"])])])),[[_,m.value]])]),_:1})])}}}),ye={class:"authentication-setting__main main-calc-height"},we={class:"form-container p-24"},ke={class:"text-right"},Ve=Q({__name:"OIDC",setup(M){const a=V({id:"",auth_type:"OIDC",config_data:{authEndpoint:"",tokenEndpoint:"",userInfoEndpoint:"",clientId:"",clientSecret:"",redirectUrl:""},is_active:!0}),h=V(),m=V(!1),f=F({"config_data.authEndpoint":[{required:!0,message:i("views.system.authentication.oidc.authEndpointPlaceholder"),trigger:"blur"}],"config_data.tokenEndpoint":[{required:!0,message:i("views.system.authentication.oidc.tokenEndpointPlaceholder"),trigger:"blur"}],"config_data.userInfoEndpoint":[{required:!0,message:i("views.system.authentication.oidc.userInfoEndpointPlaceholder"),trigger:"blur"}],"config_data.clientId":[{required:!0,message:i("views.system.authentication.oidc.clientIdPlaceholder"),trigger:"blur"}],"config_data.clientSecret":[{required:!0,message:i("views.system.authentication.oidc.clientSecretPlaceholder"),trigger:"blur"}],"config_data.redirectUrl":[{required:!0,message:i("views.system.authentication.oidc.redirectUrlPlaceholder"),trigger:"blur"}],"config_data.logoutEndpoint":[{required:!0,message:i("views.system.authentication.oidc.logoutEndpointPlaceholder"),trigger:"blur"}]}),w=async(e,l)=>{e&&await e.validate((u,s)=>{u&&D.putAuthSetting(a.value.auth_type,a.value,m).then(k=>{N(i("common.saveSuccess"))})})};function r(){D.getAuthSetting(a.value.auth_type,m).then(e=>{e.data&&JSON.stringify(e.data)!=="{}"&&(a.value=e.data)})}return O(()=>{r()}),(e,l)=>{const u=d("el-input"),s=d("el-form-item"),k=d("el-checkbox"),E=d("el-form"),P=d("el-button"),c=d("el-scrollbar"),_=z("loading");return g(),y("div",ye,[t(c,null,{default:n(()=>[B((g(),y("div",we,[t(E,{ref_key:"authFormRef",ref:h,rules:f,model:a.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[t(s,{label:e.$t("views.system.authentication.oidc.authEndpoint"),prop:"config_data.authEndpoint"},{default:n(()=>[t(u,{modelValue:a.value.config_data.authEndpoint,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.config_data.authEndpoint=o),placeholder:e.$t("views.system.authentication.oidc.authEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oidc.tokenEndpoint"),prop:"config_data.tokenEndpoint"},{default:n(()=>[t(u,{modelValue:a.value.config_data.tokenEndpoint,"onUpdate:modelValue":l[1]||(l[1]=o=>a.value.config_data.tokenEndpoint=o),placeholder:e.$t("views.system.authentication.oidc.tokenEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oidc.userInfoEndpoint"),prop:"config_data.userInfoEndpoint"},{default:n(()=>[t(u,{modelValue:a.value.config_data.userInfoEndpoint,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.config_data.userInfoEndpoint=o),placeholder:e.$t("views.system.authentication.oidc.userInfoEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oidc.clientId"),prop:"config_data.clientId"},{default:n(()=>[t(u,{modelValue:a.value.config_data.clientId,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.config_data.clientId=o),placeholder:e.$t("views.system.authentication.oidc.clientIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oidc.clientSecret"),prop:"config_data.clientSecret"},{default:n(()=>[t(u,{modelValue:a.value.config_data.clientSecret,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.config_data.clientSecret=o),placeholder:e.$t("views.system.authentication.oidc.clientSecretPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oidc.redirectUrl"),prop:"config_data.redirectUrl"},{default:n(()=>[t(u,{modelValue:a.value.config_data.redirectUrl,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.config_data.redirectUrl=o),placeholder:e.$t("views.system.authentication.oidc.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,null,{default:n(()=>[t(k,{modelValue:a.value.is_active,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.is_active=o)},{default:n(()=>[$(b(e.$t("views.system.authentication.oidc.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",ke,[t(P,{onClick:l[7]||(l[7]=o=>w(h.value)),type:"primary",disabled:m.value},{default:n(()=>[$(b(e.$t("common.save")),1)]),_:1},8,["disabled"])])])),[[_,m.value]])]),_:1})])}}}),$e="/ui/assets/logo_dingtalk-ba6ce262.svg",Ue="/ui/assets/logo_lark-040c9608.svg",Ce="/ui/assets/logo_wechat-work-74043648.svg",Pe="/ui/assets/logo_wechat-8623e982.svg",Se={class:"flex align-center",style:{"margin-left":"-8px"}},Ee={class:"dialog-footer"},Ae=Q({__name:"EditModal",emits:["refresh"],setup(M,{expose:a,emit:h}){const m=V(!1),f=V(!1),w=V(),r=F({key:"",logoSrc:"",name:"",isActive:!1,isValid:!1,config:{}}),e=p=>({corp_id:"Corp ID",app_key:(r==null?void 0:r.key)!="lark"?"APP Key":"App ID",app_secret:"APP Secret",agent_id:"Agent ID",callback_url:i("views.application.applicationAccess.callback")})[p]||(p?p.charAt(0).toUpperCase()+p.slice(1):""),l=p=>{switch(p){case"app_key":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.appKeyPlaceholder"),trigger:["blur","change"]}];case"app_secret":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.appSecretPlaceholder"),trigger:["blur","change"]}];case"corp_id":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.corpIdPlaceholder"),trigger:["blur","change"]}];case"agent_id":return[{required:!0,message:i("views.system.authentication.scanTheQRCode.agentIdPlaceholder"),trigger:["blur","change"]}];case"callback_url":return[{required:!0,message:i("views.application.applicationAccess.callbackTip"),trigger:["blur","change"]},{pattern:/^https?:\/\/.+/,message:i("views.system.authentication.scanTheQRCode.callbackWarning"),trigger:["blur","change"]}];default:return[]}};a({open:async p=>{var T;m.value=!0,f.value=!0,Object.assign(r,p);let U=window.location.origin;switch(p.key){case"wecom":r.config.app_key&&(r.config.agent_id=r.config.app_key,delete r.config.app_key),r.config.callback_url=`${U}/api/wecom`;break;case"dingtalk":r.config.agent_id&&(r.config.corp_id=r.config.agent_id,delete r.config.agent_id),r.config={corp_id:r.config.corp_id,app_key:r.config.app_key,app_secret:r.config.app_secret,callback_url:U};break;case"lark":r.config.callback_url=`${U}/api/feishu`;break}(T=w.value)==null||T.clearValidate()}});const s=()=>{var p;(p=w.value)==null||p.validate(U=>{U?o():Y(i("views.system.authentication.scanTheQRCode.validateFailedTip"))})},k=()=>{var p;m.value=!1,(p=w.value)==null||p.clearValidate(),_("refresh")};function E(){J.validateConnection(r,f).then(p=>{p.data?N(i("views.system.authentication.scanTheQRCode.validateSuccess")):Y(i("views.system.authentication.scanTheQRCode.validateFailed"))})}const P=new Set(["app_secret","client_secret","secret"]),c=p=>P.has(p),_=h;function o(){J.updateConfig(r,f).then(p=>{var U;N(i("common.saveSuccess")),_("refresh"),m.value=!1,(U=w.value)==null||U.clearValidate()})}return(p,U)=>{const T=d("el-input"),K=d("el-form-item"),L=d("el-button"),j=d("el-drawer");return g(),R(j,{modelValue:m.value,"onUpdate:modelValue":U[0]||(U[0]=H=>m.value=H),size:"60%","append-to-body":!0,"destroy-on-close":!0,onClose:k},{header:n(()=>[C("div",Se,[C("h4",null,b(r.name+" "+p.$t("common.setting")),1)])]),footer:n(()=>[C("span",Ee,[t(L,{onClick:k},{default:n(()=>[$(b(p.$t("common.cancel")),1)]),_:1}),t(L,{onClick:E},{default:n(()=>[$(b(p.$t("views.system.authentication.scanTheQRCode.validate")),1)]),_:1}),t(L,{type:"primary",onClick:s},{default:n(()=>[$(b(p.$t("common.save")),1)]),_:1})])]),default:n(()=>[t(oe(se),{model:r.config,"label-width":"120px","label-position":"top","require-asterisk-position":"right",ref_key:"formRef",ref:w},{default:n(()=>[(g(!0),y(W,null,G(r.config,(H,A)=>(g(),R(K,{key:A,label:e(A),prop:A,rules:l(A)},{default:n(()=>[t(T,{modelValue:r.config[A],"onUpdate:modelValue":X=>r.config[A]=X,type:c(A)?"password":"text","show-password":c(A)},null,8,["modelValue","onUpdate:modelValue","type","show-password"])]),_:2},1032,["label","prop","rules"]))),128))]),_:1},8,["model"])]),_:1},8,["modelValue"])}}});const Ie=x(Ae,[["__scopeId","data-v-78944c9a"]]),qe={class:"flex-between"},Re={class:"flex align-center ml-8 mr-8"},De=["src"],Ne={style:{"margin-left":"8px"}},Te={key:1},Fe={class:"mr-4"},Qe={key:0,class:"border-t mt-16"},Me={class:"mt-4 mb-16 flex align-center"},Oe={key:0,class:"vertical-middle lighter break-all ellipsis-1"},Le={key:1,class:"vertical-middle lighter break-all ellipsis-1"},Je={key:2,class:"vertical-middle lighter break-all ellipsis-1"},ze=Q({__name:"SCAN",setup(M){const a=V(),h=V(!1),m=F(w()),f=F({});O(()=>{l()});function w(){return[r("wecom",i("views.system.authentication.scanTheQRCode.wecom")),r("dingtalk",i("views.system.authentication.scanTheQRCode.dingtalk")),r("lark",i("views.system.authentication.scanTheQRCode.lark"))]}function r(c,_){let o="";switch(c){case"wecom":o="wechat-work";break;case"dingtalk":o="dingtalk";break;case"lark":o="lark";break;default:o="";break}const p={...c==="wecom"?{corp_id:"",agent_id:""}:{app_key:""},app_secret:"",callback_url:""};return{key:c,logoSrc:new URL(Object.assign({"../../../assets/logo_dingtalk.svg":$e,"../../../assets/logo_lark.svg":Ue,"../../../assets/logo_wechat-work.svg":Ce,"../../../assets/logo_wechat.svg":Pe})[`../../../assets/logo_${o}.svg`],self.location).href,name:_,isActive:!1,isValid:!1,config:p}}function e(c,_){return{corp_id:"Corp ID",app_key:(_==null?void 0:_.key)!="lark"?"APP Key":"App ID",app_secret:"APP Secret",agent_id:"Agent ID",callback_url:i("views.application.applicationAccess.callback")}[c]||(c?c.charAt(0).toUpperCase()+c.slice(1):"")}function l(){h.value=!0,J.getPlatformInfo(h).then(c=>{c&&m.forEach(_=>{const o=c.data.find(p=>p.platform===_.key);if(o){if(Object.assign(_,{isValid:o.is_valid,isActive:o.is_active,config:o.config}),_.key==="dingtalk"){const{corp_id:p,app_key:U,app_secret:T}=_.config;_.config={corp_id:p,app_key:U,app_secret:T,callback_url:_.config.callback_url}}f[_.key]={},f[_.key].app_secret=!1}})})}function u(c){J.validateConnection(c,h).then(_=>{_.data?N(i("views.system.authentication.scanTheQRCode.validateSuccess")):Y(i("views.system.authentication.scanTheQRCode.validateFailed"))})}function s(){l()}function k(c){J.updateConfig(c,h).then(_=>{N(i("common.saveSuccess"))})}function E(c){f[c]||(f[c]={}),f[c].app_secret=!f[c].app_secret}function P(c){var _;(_=a.value)==null||_.open(c)}return(c,_)=>{const o=d("el-tag"),p=d("el-button"),U=d("el-switch"),T=d("el-text"),K=d("AppIcon"),L=d("Hide"),j=d("el-icon"),H=d("View"),A=d("el-col"),X=d("el-row"),ne=d("el-collapse-transition"),ee=d("el-card"),ie=z("loading");return B((g(),y("div",null,[t(ee,{shadow:"hover",class:"border-none cursor",style:{"--el-card-padding":"16px 24px"}},{default:n(()=>[(g(!0),y(W,null,G(m,v=>(g(),y("div",{key:v.key,class:"mb-16"},[t(ee,{class:"mb-16",shadow:"hover",style:{"--el-card-padding":"16px"}},{default:n(()=>[C("div",qe,[C("div",Re,[C("img",{src:v.logoSrc,alt:"",class:"icon"},null,8,De),C("h5",Ne,b(v.name),1),v.isValid?(g(),R(o,{key:0,type:"success",class:"ml-4"},{default:n(()=>[$(b(c.$t("views.system.authentication.scanTheQRCode.effective")),1)]),_:1})):I("",!0)]),C("div",null,[v.isValid?I("",!0):(g(),R(p,{key:0,type:"primary",onClick:q=>P(v)},{default:n(()=>_[0]||(_[0]=[$("接入 ")])),_:2},1032,["onClick"])),v.isValid?(g(),y("span",Te,[C("span",Fe,b(v.isActive?c.$t("views.system.authentication.scanTheQRCode.alreadyTurnedOn"):c.$t("views.system.authentication.scanTheQRCode.notEnabled")),1),t(U,{size:"small",modelValue:v.isActive,"onUpdate:modelValue":q=>v.isActive=q,disabled:!v.isValid,onChange:q=>k(v)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])):I("",!0)])]),t(ne,null,{default:n(()=>[v.isValid?(g(),y("div",Qe,[t(X,{gutter:12,class:"mt-16"},{default:n(()=>[(g(!0),y(W,null,G(v.config,(q,S)=>(g(),R(A,{key:S,span:12},{default:n(()=>{var te,ae;return[t(T,{type:"info"},{default:n(()=>[$(b(e(S,v)),1)]),_:2},1024),C("div",Me,[S!=="app_secret"?(g(),y("span",Oe,b(q),1)):I("",!0),S==="app_secret"&&!((te=f[v.key])!=null&&te[S])?(g(),y("span",Le,"************")):I("",!0),S==="app_secret"&&((ae=f[v.key])!=null&&ae[S])?(g(),y("span",Je,b(q),1)):I("",!0),t(p,{type:"primary",text:"",onClick:()=>oe(de)(q)},{default:n(()=>[t(K,{iconName:"app-copy"})]),_:2},1032,["onClick"]),S==="app_secret"?(g(),R(p,{key:3,type:"primary",text:"",onClick:Z=>E(v.key)},{default:n(()=>{var Z,le;return[S==="app_secret"&&!((Z=f[v.key])!=null&&Z[S])?(g(),R(j,{key:0},{default:n(()=>[t(L)]),_:1})):I("",!0),S==="app_secret"&&((le=f[v.key])!=null&&le[S])?(g(),R(j,{key:1},{default:n(()=>[t(H)]),_:1})):I("",!0)]}),_:2},1032,["onClick"])):I("",!0)])]}),_:2},1024))),128))]),_:2},1024),t(p,{type:"primary",onClick:q=>P(v)},{default:n(()=>[$(b(c.$t("common.edit")),1)]),_:2},1032,["onClick"]),t(p,{onClick:q=>u(v)},{default:n(()=>[$(b(c.$t("views.system.authentication.scanTheQRCode.validate")),1)]),_:2},1032,["onClick"])])):I("",!0)]),_:2},1024)]),_:2},1024)]))),128)),t(Ie,{ref_key:"EditModelRef",ref:a,onRefresh:s},null,512)]),_:1})])),[[ie,h.value]])}}});const Be=x(ze,[["__scopeId","data-v-8fd44c12"]]),je={class:"authentication-setting__main main-calc-height"},He={class:"form-container p-24"},We={class:"text-right"},Ge=Q({__name:"OAuth2",setup(M){const a=V({id:"",auth_type:"OAuth2",config_data:{authEndpoint:"",tokenEndpoint:"",userInfoEndpoint:"",scope:"",clientId:"",clientSecret:"",redirectUrl:"",fieldMapping:""},is_active:!0}),h=V(),m=V(!1),f=F({"config_data.authEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.authEndpointPlaceholder"),trigger:"blur"}],"config_data.tokenEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.tokenEndpointPlaceholder"),trigger:"blur"}],"config_data.userInfoEndpoint":[{required:!0,message:i("views.system.authentication.oauth2.userInfoEndpointPlaceholder"),trigger:"blur"}],"config_data.scope":[{required:!0,message:i("views.system.authentication.oauth2.scopePlaceholder"),trigger:"blur"}],"config_data.clientId":[{required:!0,message:i("views.system.authentication.oauth2.clientIdPlaceholder"),trigger:"blur"}],"config_data.clientSecret":[{required:!0,message:i("views.system.authentication.oauth2.clientSecretPlaceholder"),trigger:"blur"}],"config_data.redirectUrl":[{required:!0,message:i("views.system.authentication.oauth2.redirectUrlPlaceholder"),trigger:"blur"}],"config_data.fieldMapping":[{required:!0,message:i("views.system.authentication.oauth2.filedMappingPlaceholder"),trigger:"blur"}]}),w=async(e,l)=>{e&&await e.validate((u,s)=>{u&&D.putAuthSetting(a.value.auth_type,a.value,m).then(k=>{N(i("common.saveSuccess"))})})};function r(){D.getAuthSetting(a.value.auth_type,m).then(e=>{e.data&&JSON.stringify(e.data)!=="{}"&&(a.value=e.data)})}return O(()=>{r()}),(e,l)=>{const u=d("el-input"),s=d("el-form-item"),k=d("el-checkbox"),E=d("el-form"),P=d("el-button"),c=d("el-scrollbar"),_=z("loading");return g(),y("div",je,[t(c,null,{default:n(()=>[B((g(),y("div",He,[t(E,{ref_key:"authFormRef",ref:h,rules:f,model:a.value,"label-position":"top","require-asterisk-position":"right"},{default:n(()=>[t(s,{label:e.$t("views.system.authentication.oauth2.authEndpoint"),prop:"config_data.authEndpoint"},{default:n(()=>[t(u,{modelValue:a.value.config_data.authEndpoint,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.config_data.authEndpoint=o),placeholder:e.$t("views.system.authentication.oauth2.authEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oauth2.tokenEndpoint"),prop:"config_data.tokenEndpoint"},{default:n(()=>[t(u,{modelValue:a.value.config_data.tokenEndpoint,"onUpdate:modelValue":l[1]||(l[1]=o=>a.value.config_data.tokenEndpoint=o),placeholder:e.$t("views.system.authentication.oauth2.tokenEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oauth2.userInfoEndpoint"),prop:"config_data.userInfoEndpoint"},{default:n(()=>[t(u,{modelValue:a.value.config_data.userInfoEndpoint,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.config_data.userInfoEndpoint=o),placeholder:e.$t("views.system.authentication.oauth2.userInfoEndpointPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oauth2.scope"),prop:"config_data.scope"},{default:n(()=>[t(u,{modelValue:a.value.config_data.scope,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.config_data.scope=o),placeholder:e.$t("views.system.authentication.oauth2.scopePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oauth2.clientId"),prop:"config_data.clientId"},{default:n(()=>[t(u,{modelValue:a.value.config_data.clientId,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.config_data.clientId=o),placeholder:e.$t("views.system.authentication.oauth2.clientIdPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oauth2.clientSecret"),prop:"config_data.clientSecret"},{default:n(()=>[t(u,{modelValue:a.value.config_data.clientSecret,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.config_data.clientSecret=o),placeholder:e.$t("views.system.authentication.oauth2.clientSecretPlaceholder"),"show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oauth2.redirectUrl"),prop:"config_data.redirectUrl"},{default:n(()=>[t(u,{modelValue:a.value.config_data.redirectUrl,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.config_data.redirectUrl=o),placeholder:e.$t("views.system.authentication.oauth2.redirectUrlPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,{label:e.$t("views.system.authentication.oauth2.filedMapping"),prop:"config_data.fieldMapping"},{default:n(()=>[t(u,{modelValue:a.value.config_data.fieldMapping,"onUpdate:modelValue":l[7]||(l[7]=o=>a.value.config_data.fieldMapping=o),placeholder:e.$t("views.system.authentication.oauth2.filedMappingPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(s,null,{default:n(()=>[t(k,{modelValue:a.value.is_active,"onUpdate:modelValue":l[8]||(l[8]=o=>a.value.is_active=o)},{default:n(()=>[$(b(e.$t("views.system.authentication.oauth2.enableAuthentication")),1)]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"]),C("div",We,[t(P,{onClick:l[9]||(l[9]=o=>w(h.value)),type:"primary",disabled:m.value},{default:n(()=>[$(b(e.$t("common.save")),1)]),_:1},8,["disabled"])])])),[[_,m.value]])]),_:1})])}}}),Ke={class:"authentication-setting p-16-24"},Xe=Q({__name:"index",setup(M){const{user:a}=re(),h=ce(),m=V("LDAP"),f=[{label:i("views.system.authentication.ldap.title"),name:"LDAP",component:ge},{label:i("views.system.authentication.cas.title"),name:"CAS",component:be},{label:i("views.system.authentication.oidc.title"),name:"OIDC",component:Ve},{label:i("views.system.authentication.oauth2.title"),name:"OAuth2",component:Ge},{label:i("views.system.authentication.scanTheQRCode.title"),name:"SCAN",component:Be}];function w(){}return O(()=>{a.isExpire()&&h.push({path:"/application"})}),(r,e)=>{const l=d("el-tab-pane"),u=d("el-tabs");return g(),y("div",Ke,[C("h4",null,b(r.$t("views.system.authentication.title")),1),t(u,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),class:"demo-tabs",onTabClick:w},{default:n(()=>[(g(),y(W,null,G(f,(s,k)=>t(l,{key:k,label:s.label,name:s.name},{default:n(()=>[(g(),R(ue(s.component)))]),_:2},1032,["label","name"])),64))]),_:1},8,["modelValue"])])}}});const xe=x(Xe,[["__scopeId","data-v-8e09e0c8"]]);export{xe as default};
